var view_path="views/",pcolor="#1C536F",_bimay_url="http://binusmaya.binus.ac.id",_bimay_api_url="http://apps.binusmaya.binus.ac.id",app=angular.module("BinusMaya",["ionic","listRoute","BinusMayaFactory"]).run(["$ionicPlatform","$rootScope","$ionicHistory","$ionicNavBarDelegate","BinusMaya",function(e,t,a,o,n){t.login="undefined"==typeof localStorage.islogin?!1:localStorage.islogin,t.leftMenu=!1,t.loginName="undefined"==typeof localStorage.fname?null:localStorage.fname.toLowerCase(),t.profileImage="undefined"==typeof localStorage.profileImage?!1:localStorage.profileImage,delete localStorage.cookie,delete localStorage.templogin,e.ready(function(){t.onLoadStyle={opacity:1},window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()}),t.getLastUpdate=function(){t.lastUpdate="undefined"==typeof localStorage.lastUpdate?"Whatever":localStorage.lastUpdate},t.getLastUpdate(),t.logout=function(){localStorage.clear(),window.location.hash="#/",a.clearHistory(),o.showBackButton(!1),location.reload()},t.getProfileImage=function(){n.getProfileImage(function(e){localStorage.profileImage=e,t.profileImage=e},function(){})},window.location.hash=t.login?"/schedule":"/"}]).config(["$ionicConfigProvider",function(e){e.views.forwardCache(!1),e.views.maxCache(0)}]);angular.module("BinusMayaFactory",[]).factory("BinusMaya",["$q",function(e){return{_bimay_url:"http://binusmaya.binus.ac.id",_bimay_api_url:"http://apps.binusmaya.binus.ac.id",headers:function(){var e=this;return{Cookie:localStorage.cookie?localStorage.cookie:null,Origin:e._bimay_url,Referer:e._bimay_url}},checkLogin:function(){var t=this,a=JSON.parse(localStorage.loginId);return e(function(e,o){return localStorage.templogin!==!0?t.api("/","get").then(function(e){200!==e.code&&o(e);var n={};return $($(e.result).serializeArray()).each(function(e,t){n[t.name]=t.value}),n.txtUserId=a.binusid,n.txtPassword=a.password,n.btnLogin="Log In ",t.api("/","post",n)},o).then(function(){localStorage.templogin=!0,e(!0)},o):(e(!0),void 0)})},api:function(t,a,o,n){var l=this;return void 0===localStorage.cookie?l._getCookie().then(function(){return l.api(t,a,o)}):e(function(e,r){"get"===a?httpclient.get(n?t:l._bimay_url+t,e,r,{headers:l.headers()}):httpclient.post(n?t:l._bimay_url+t,o,e,r,{headers:l.headers()})})},frame:function(t){var a=this,o="";return e(function(e,n){return a.api(t,"get").then(function(e){return a.api($(e.result).find("#ctl00_cp1_ifrApp").attr("src"),"get")},n).then(function(e){return o=$(e.result).find("#ifrApp").attr("src"),a.api(o,"get",{},!0)},n).then(function(t){e({url:o,result:t})},n)})},_getCookie:function(){var t=this;return e(function(e,a){httpclient.get(t._bimay_url,function(t){200==t.code?(localStorage.cookie=t.header["Set-Cookie"],e(!0)):a(t)},e)})},_requestError:function(){},grouping:function(e){if(e.length<=0)return[];var t=[],a="",o=-1,n=0;return e.forEach(function(e){a==e.date?(t[o].data[n]=e,n++):(n=1,o++,a=e.date,t[o]={date:e.date,data:[]},t[o].data[0]=e)}),t}}}]),angular.module("listRoute",[]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("index",{url:"/",views:{"main-view":{templateUrl:view_path+"login.html"}}}).state("schedule",{url:"/schedule",views:{"main-view":{templateUrl:view_path+"schedule.html",controller:"ScheduleController"}}}).state("about",{url:"/about",views:{"main-view":{templateUrl:view_path+"about.html"}}}).state("forum",{url:"/forum",views:{"main-view":{templateUrl:view_path+"forum.html",controller:"ForumController"}}}).state("services",{url:"/services",views:{"main-view":{templateUrl:view_path+"services/index.html",controller:"ServicesController"}}}).state("myclass",{url:"/myclass",views:{"main-view":{templateUrl:view_path+"myclass.html",controller:"MyClassController"}}}).state("myclassDetail",{url:"/myclass-detail/:code",resolve:{dataset:["$q","$stateParams","$location",function(e,t,a){var o=!1,n=e.defer(),l="undefined"!=typeof localStorage.myClass?JSON.parse(localStorage.myClass):!1;for(var r in l)l[r].code==t.code&&(o=r);return o?n.resolve(o):a.path("/myclass").replace(),n.promise}]},views:{"main-view":{templateUrl:view_path+"myclassInside.html",controller:"MyClassDetailController"}}}).state("examSchedule",{url:"/exam-schedule",views:{"main-view":{templateUrl:view_path+"services/exam-schedule.html",controller:"ExamScheduleController"}}}).state("examScore",{url:"/exam-score",views:{"main-view":{templateUrl:view_path+"services/exam-score.html",controller:"ExamScoreController"}}}).state("financeStatus",{url:"/finance-status",views:{"main-view":{templateUrl:view_path+"services/billing.html",controller:"FinanceController"}}}).state("absence",{url:"/absence",views:{"main-view":{templateUrl:view_path+"services/absence.html",controller:"AbsenceController"}}}).state("coming",{url:"/coming",views:{"main-view":{templateUrl:view_path+"coming.html"}}}),t.otherwise("/coming")}]),app.controller("LoginController",["$scope","$ionicPopup","$timeout","$ionicHistory","$ionicNavBarDelegate","$rootScope","BinusMaya",function(e,t,a,o,n,l,r){l.noHeader=!0,n.showBar(!1),e.loading=!1,e.loginClass="",o.nextViewOptions({disableBack:!0}),e.submit=function(){if(e.binusid&&e.password){e.loginClass="on-loading",e.loading=!0,r.api("/","get").then(function(t){200!==t.code&&a(t);var o={};return $($(t.result).serializeArray()).each(function(e,t){o[t.name]=t.value}),o.txtUserId=e.binusid,o.txtPassword=e.password,o.btnLogin="Log In ",r.api("/","post",o)},a).then(function(t){var r=$(t.result).find("#content #topbar .right strong");200!==t.code&&a(t),r.length<=0?a(t,$(t.result).find("#lblError").text()):(e.loading=!1,e.loginClass="",localStorage.loginId=JSON.stringify({binusid:e.binusid,password:e.password}),localStorage.islogin=!0,localStorage.fname=r.text(),l.login=!0,l.loginName=localStorage.fname.toLowerCase(),e.loginClass="",e.loading=!1,window.location.hash="#/schedule",o.clearHistory(),n.showBackButton(!1))},a);var a=function(a,o){e.loading=!1,e.loginClass="",t.alert({title:"Oops !",template:o?o:"Something wrong !"})}}else t.alert({title:"Oops !",template:"Please Input Binusian ID and Password"})}}]),app.controller("MyClassController",["$scope","BinusMaya","$ionicNavBarDelegate","$state","$location","$stateParams","$timeout","$rootScope","$ionicPlatform","$q","$ionicPopup",function(e,t,a,o,n,l,r,i,c,s,u){i.noHeader=!1,i.leftMenu=!0,c.onHardwareBackButton(function(e){e.preventDefault()}),e.classData="undefined"!=typeof localStorage.myClass?JSON.parse(localStorage.myClass):!1;var m=function(){return s(function(e,a){t.checkLogin().then(function(){return t.api("/","get")},function(){a("can't re-auth your account")}).then(function(e){return t.frame($(e.result).find(".itemContent ul li:eq(0) > a").attr("href"))},function(){a("can't access to main frame")}).then(function(t){var a=[];$(t.result.result).find("#ctl00_ContentPlaceHolder1_pnlTeori ul li").each(function(e,t){var o=$(t).find("a").html(),n=o.match(/^(.*)-(.*) \((.*)\)/i);a.push({indexItem:e,name:n[2],url:$(t).find("a").attr("href"),code:n[1],className:n[3]})}),localStorage.myClass=JSON.stringify(a),e(a)},function(){a("can't access to my class")})})};e.doRefresh=function(){m().then(function(a){a.length>0?e.classData=a:t("You don't have any class"),e.$broadcast("scroll.refreshComplete")},t);var t=function(t){u.alert({title:"Oops !",template:t}),e.$broadcast("scroll.refreshComplete")}}}]),app.controller("ScheduleController",["$scope","$ionicPopup","$timeout","$ionicHistory","$rootScope","$ionicPlatform","BinusMaya","$q",function(e,t,a,o,n,l,r,i){if(n.noHeader=!1,n.leftMenu=!0,l.onHardwareBackButton(function(e){e.preventDefault()}),e.getState=function(e){var t=moment();return moment(e).isSame(t,"day")?"today":moment(e).isSame(t.add(1,"d"),"day")?"tomorrow":moment(e)<t?"completo":void 0},e.getCourseState=function(e,t){var a=moment(),o=null;try{var n=t.split("-")[1].split(":"),l=parseInt(n[0]),r=parseInt(n[1]);o=moment(e).hour(l).minute(r)}catch(i){o=moment(e)}return a>o?"completo":void 0},e.isSchedule=!1,e.schedule=[],localStorage.jadwal)try{JSON.parse(localStorage.jadwal).length>0&&(e.isSchedule=!0,e.schedule=JSON.parse(localStorage.jadwal))}catch(c){}var s=function(e){var t=[];return $(e).find("tr").each(function(e){var a=$(this).find("td");e>0&&t.push({date:a.eq(0).html(),time:a.eq(1).html(),state:a.eq(2).html(),course:a.eq(3).html().split("-")[1],code:a.eq(3).html().split("-")[0],myClass:a.eq(5).html(),room:a.eq(6).html(),building:a.eq(7).html()})}),t},u=function(){return i(function(e,t){r.checkLogin().then(function(){return r.api("/","get")},function(){t("can't re-auth your account")}).then(function(e){return r.frame($(e.result).find(".itemContent ul li:eq(0) > a").attr("href"))},function(){t("can't access to main frame")}).then(function(e){var t={},a=e.result;return $($(a.result).serializeArray()).each(function(e,a){t[a.name]=a.value}),t.__EVENTTARGET="ctl00$ContentPlaceHolder1$btnSchedule",r.api(_bimay_api_url+"/LMS/MyClass.aspx","post",t,!0)},function(){t("can't access frame")}).then(function(t){console.log(t);var a=$(t.result).find("table"),o=s(a.eq(0).html()),n=s(a.eq(1).html()),l=o.concat(n);localStorage.jadwal=JSON.stringify(r.grouping(l)),localStorage.lastUpdate=moment().format("D MMMM YYYY h:mm:ss"),e({jadwal:JSON.parse(localStorage.jadwal),lastUpdate:localStorage.lastUpdate})},function(){t("can't access schedule page")})})};e.doRefresh=function(){u().then(function(t){console.log(t),e.$broadcast("scroll.refreshComplete"),n.getLastUpdate(),t.jadwal.length>0?(e.isSchedule=!0,e.schedule=t.jadwal):a("No Schedule found")},a);var a=function(a){t.alert({title:"Oops !",template:a}),e.$broadcast("scroll.refreshComplete")}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImJpbnVzbWF5YS5qcyIsInJvdXRlLmpzIiwiY29udHJvbGxlcnMvbG9naW4uY29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL215Y2xhc3MuY29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL3NjaGVkdWxlLmNvbnRyb2xsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBVUEsR0FBQSxXQUFBLFNBQ0EsT0FBQSxVQUNBLFdBQUEsK0JBQ0EsZUFBQSxvQ0FFQSxJQUFBLFFBQUEsT0FBQSxhQUFBLFFBQUEsWUFBQSxxQkFFQSxLQUFBLGlCQUFBLGFBQUEsZ0JBQUEsdUJBQUEsWUFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FFQSxFQUFBLE1BQUEsbUJBQUEsY0FBQSxTQUFBLEVBQUEsYUFBQSxRQUNBLEVBQUEsVUFBQSxFQUNBLEVBQUEsVUFBQSxtQkFBQSxjQUFBLE1BQUEsS0FBQSxhQUFBLE1BQUEsY0FDQSxFQUFBLGFBQUEsbUJBQUEsY0FBQSxjQUFBLEVBQUEsYUFBQSxtQkFDQSxjQUFBLGFBQ0EsY0FBQSxVQUVBLEVBQUEsTUFBQSxXQUNBLEVBQUEsYUFDQSxRQUFBLEdBSUEsT0FBQSxTQUFBLE9BQUEsUUFBQSxRQUFBLFVBQ0EsUUFBQSxRQUFBLFNBQUEsMEJBQUEsR0FFQSxPQUFBLFdBQ0EsVUFBQSxpQkFJQSxFQUFBLGNBQUEsV0FDQSxFQUFBLFdBQUEsbUJBQUEsY0FBQSxXQUFBLFdBQUEsYUFBQSxZQUVBLEVBQUEsZ0JBQ0EsRUFBQSxPQUFBLFdBQ0EsYUFBQSxRQUNBLE9BQUEsU0FBQSxLQUFBLEtBQ0EsRUFBQSxlQUNBLEVBQUEsZ0JBQUEsR0FDQSxTQUFBLFVBR0EsRUFBQSxnQkFBQSxXQUVBLEVBQUEsZ0JBQ0EsU0FBQSxHQUNBLGFBQUEsYUFBQSxFQUNBLEVBQUEsYUFBQSxHQUVBLGVBTUEsT0FBQSxTQUFBLEtBREEsRUFBQSxNQUNBLFlBRUEsT0FJQSxRQUFBLHVCQUFBLFNBQUEsR0FDQSxFQUFBLE1BQUEsY0FBQSxHQUNBLEVBQUEsTUFBQSxTQUFBLEtDekVBLFNBQUEsT0FBQSx1QkFFQSxRQUFBLGFBQUEsS0FBQSxTQUFBLEdBQ0EsT0FFQSxXQUFBLCtCQUNBLGVBQUEsb0NBRUEsUUFBQSxXQUNBLEdBQUEsR0FBQSxJQUNBLFFBQ0EsT0FBQSxhQUFBLE9BQUEsYUFBQSxPQUFBLEtBQ0EsT0FBQSxFQUFBLFdBQ0EsUUFBQSxFQUFBLGFBR0EsV0FBQSxXQUNBLEdBQUEsR0FBQSxLQUNBLEVBQUEsS0FBQSxNQUFBLGFBQUEsUUFDQSxPQUFBLEdBQUEsU0FBQSxFQUFBLEdBQ0EsTUFBQSxjQUFBLGFBQUEsRUFHQSxFQUFBLElBQUEsSUFBQSxPQUNBLEtBQUEsU0FBQSxHQUNBLE1BQUEsRUFBQSxNQUFBLEVBQUEsRUFDQSxJQUFBLEtBT0EsT0FOQSxHQUFBLEVBQUEsRUFBQSxRQUFBLGtCQUFBLEtBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxFQUFBLE1BQUEsRUFBQSxRQUVBLEVBQUEsVUFBQSxFQUFBLFFBQ0EsRUFBQSxZQUFBLEVBQUEsU0FDQSxFQUFBLFNBQUEsVUFDQSxFQUFBLElBQUEsSUFBQSxPQUFBLElBQ0EsR0FDQSxLQUFBLFdBQ0EsYUFBQSxXQUFBLEVBQ0EsR0FBQSxJQUNBLElBakJBLEdBQUEsR0FBQSxXQXFCQSxJQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxHQUFBLEdBQUEsSUFFQSxPQUFBLFVBQUEsYUFBQSxPQUNBLEVBQUEsYUFDQSxLQUFBLFdBQ0EsTUFBQSxHQUFBLElBQUEsRUFBQSxFQUFBLEtBR0EsRUFBQSxTQUFBLEVBQUEsR0FDQSxRQUFBLEVBQ0EsV0FBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLFdBQUEsRUFBQSxFQUFBLEdBQ0EsUUFBQSxFQUFBLFlBR0EsV0FBQSxLQUFBLEVBQUEsRUFBQSxFQUFBLFdBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxRQUFBLEVBQUEsZUFPQSxNQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsS0FDQSxFQUFBLEVBQ0EsT0FBQSxHQUFBLFNBQUEsRUFBQSxHQUNBLE1BQUEsR0FBQSxJQUFBLEVBQUEsT0FDQSxLQUFBLFNBQUEsR0FDQSxNQUFBLEdBQUEsSUFBQSxFQUFBLEVBQUEsUUFBQSxLQUFBLHFCQUFBLEtBQUEsT0FBQSxRQUNBLEdBQ0EsS0FBQSxTQUFBLEdBRUEsTUFEQSxHQUFBLEVBQUEsRUFBQSxRQUFBLEtBQUEsV0FBQSxLQUFBLE9BQ0EsRUFBQSxJQUFBLEVBQUEsVUFBQSxJQUNBLEdBQ0EsS0FBQSxTQUFBLEdBQ0EsR0FDQSxJQUFBLEVBQ0EsT0FBQSxLQUVBLE1BSUEsV0FBQSxXQUNBLEdBQUEsR0FBQSxJQUNBLE9BQUEsR0FBQSxTQUFBLEVBQUEsR0FDQSxXQUFBLElBQUEsRUFBQSxXQUFBLFNBQUEsR0FDQSxLQUFBLEVBQUEsTUFDQSxhQUFBLE9BQUEsRUFBQSxPQUFBLGNBQ0EsR0FBQSxJQUVBLEVBQUEsSUFFQSxNQUdBLGNBQUEsYUFHQSxTQUFBLFNBQUEsR0FDQSxHQUFBLEVBQUEsUUFBQSxFQUNBLFFBRUEsSUFBQSxNQUNBLEVBQUEsR0FDQSxFQUFBLEdBQ0EsRUFBQSxDQVVBLE9BVEEsR0FBQSxRQUFBLFNBQUEsR0FDQSxHQUFBLEVBQUEsTUFDQSxFQUFBLEdBQUEsS0FBQSxHQUFBLEVBQUEsTUFFQSxFQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsS0FDQSxFQUFBLElBQUEsS0FBQSxFQUFBLEtBQUEsU0FDQSxFQUFBLEdBQUEsS0FBQSxHQUFBLEtBR0EsT0N2SEEsUUFBQSxPQUFBLGdCQUVBLFFBQUEsaUJBQUEscUJBQUEsU0FBQSxFQUFBLEdBQ0EsRUFDQSxNQUFBLFNBQ0EsSUFBQSxJQUNBLE9BQ0EsYUFDQSxZQUFBLFVBQUEsaUJBSUEsTUFBQSxZQUNBLElBQUEsWUFDQSxPQUNBLGFBQ0EsWUFBQSxVQUFBLGdCQUNBLFdBQUEseUJBSUEsTUFBQSxTQUNBLElBQUEsU0FDQSxPQUNBLGFBQ0EsWUFBQSxVQUFBLGlCQUlBLE1BQUEsU0FDQSxJQUFBLFNBQ0EsT0FDQSxhQUNBLFlBQUEsVUFBQSxhQUNBLFdBQUEsc0JBSUEsTUFBQSxZQUNBLElBQUEsWUFDQSxPQUNBLGFBQ0EsWUFBQSxVQUFBLHNCQUNBLFdBQUEseUJBSUEsTUFBQSxXQUNBLElBQUEsV0FDQSxPQUNBLGFBQ0EsWUFBQSxVQUFBLGVBQ0EsV0FBQSx3QkFJQSxNQUFBLGlCQUNBLElBQUEsd0JBQ0EsU0FDQSxTQUFBLEtBQUEsZUFBQSxZQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsR0FBQSxJQUFBLEVBQ0EsRUFBQSxFQUFBLFFBQ0EsRUFBQSxtQkFBQSxjQUFBLFFBQUEsS0FBQSxNQUFBLGFBQUEsVUFBQSxDQUNBLEtBQUEsR0FBQSxLQUFBLEdBQ0EsRUFBQSxHQUFBLE1BQUEsRUFBQSxPQUNBLEVBQUEsRUFRQSxPQUxBLEdBQ0EsRUFBQSxRQUFBLEdBRUEsRUFBQSxLQUFBLFlBQUEsVUFFQSxFQUFBLFdBR0EsT0FDQSxhQUNBLFlBQUEsVUFBQSxxQkFDQSxXQUFBLDhCQUlBLE1BQUEsZ0JBQ0EsSUFBQSxpQkFDQSxPQUNBLGFBQ0EsWUFBQSxVQUFBLDhCQUNBLFdBQUEsNkJBSUEsTUFBQSxhQUNBLElBQUEsY0FDQSxPQUNBLGFBQ0EsWUFBQSxVQUFBLDJCQUNBLFdBQUEsMEJBSUEsTUFBQSxpQkFDQSxJQUFBLGtCQUNBLE9BQ0EsYUFDQSxZQUFBLFVBQUEsd0JBQ0EsV0FBQSx3QkFJQSxNQUFBLFdBQ0EsSUFBQSxXQUNBLE9BQ0EsYUFDQSxZQUFBLFVBQUEsd0JBQ0EsV0FBQSx3QkFJQSxNQUFBLFVBQ0EsSUFBQSxVQUNBLE9BQ0EsYUFDQSxZQUFBLFVBQUEsa0JBS0EsRUFBQSxVQUFBLGNDaElBLElBQUEsV0FBQSxtQkFDQSxTQUFBLGNBQUEsV0FBQSxnQkFBQSx1QkFBQSxhQUFBLFlBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUVBLEVBQUEsVUFBQSxFQUNBLEVBQUEsU0FBQSxHQUVBLEVBQUEsU0FBQSxFQUNBLEVBQUEsV0FBQSxHQUVBLEVBQUEsaUJBQ0EsYUFBQSxJQUdBLEVBQUEsT0FBQSxXQUNBLEdBQUEsRUFBQSxTQUFBLEVBQUEsU0FLQSxDQUNBLEVBQUEsV0FBQSxhQUNBLEVBQUEsU0FBQSxFQUNBLEVBQUEsSUFBQSxJQUFBLE9BQ0EsS0FBQSxTQUFBLEdBQ0EsTUFBQSxFQUFBLE1BQUEsRUFBQSxFQUNBLElBQUEsS0FPQSxPQU5BLEdBQUEsRUFBQSxFQUFBLFFBQUEsa0JBQUEsS0FBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLEVBQUEsTUFBQSxFQUFBLFFBRUEsRUFBQSxVQUFBLEVBQUEsUUFDQSxFQUFBLFlBQUEsRUFBQSxTQUNBLEVBQUEsU0FBQSxVQUNBLEVBQUEsSUFBQSxJQUFBLE9BQUEsSUFDQSxHQUNBLEtBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLEVBQUEsUUFBQSxLQUFBLGlDQUVBLE9BQUEsRUFBQSxNQUNBLEVBQUEsR0FDQSxFQUFBLFFBQUEsRUFDQSxFQUFBLEVBQUEsRUFBQSxFQUFBLFFBQUEsS0FBQSxhQUFBLFNBRUEsRUFBQSxTQUFBLEVBQ0EsRUFBQSxXQUFBLEdBTUEsYUFBQSxRQUFBLEtBQUEsV0FDQSxRQUFBLEVBQUEsUUFDQSxTQUFBLEVBQUEsV0FHQSxhQUFBLFNBQUEsRUFDQSxhQUFBLE1BQUEsRUFBQSxPQUNBLEVBQUEsT0FBQSxFQUNBLEVBQUEsVUFBQSxhQUFBLE1BQUEsY0FDQSxFQUFBLFdBQUEsR0FDQSxFQUFBLFNBQUEsRUFDQSxPQUFBLFNBQUEsS0FBQSxhQUNBLEVBQUEsZUFDQSxFQUFBLGdCQUFBLEtBR0EsRUFFQSxJQUFBLEdBQUEsU0FBQSxFQUFBLEdBRUEsRUFBQSxTQUFBLEVBQ0EsRUFBQSxXQUFBLEdBQ0EsRUFBQSxPQUNBLE1BQUEsU0FDQSxTQUFBLEVBQUEsRUFBQSwyQkExREEsR0FBQSxPQUNBLE1BQUEsU0FDQSxTQUFBLDhDQ2JBLElBQUEsV0FBQSxxQkFDQSxTQUFBLFlBQUEsdUJBQUEsU0FBQSxZQUFBLGVBQUEsV0FBQSxhQUFBLGlCQUFBLEtBQUEsY0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFVBQUEsRUFDQSxFQUFBLFVBQUEsRUFDQSxFQUFBLHFCQUFBLFNBQUEsR0FDQSxFQUFBLG1CQUdBLEVBQUEsVUFBQSxtQkFBQSxjQUFBLFFBQUEsS0FBQSxNQUFBLGFBQUEsVUFBQSxDQUVBLElBQUEsR0FBQSxXQUNBLE1BQUEsR0FBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLGFBQ0EsS0FBQSxXQUNBLE1BQUEsR0FBQSxJQUFBLElBQUEsUUFDQSxXQUVBLEVBQUEsZ0NBR0EsS0FBQSxTQUFBLEdBQ0EsTUFBQSxHQUFBLE1BQ0EsRUFBQSxFQUFBLFFBQUEsS0FBQSxnQ0FBQSxLQUFBLFVBRUEsV0FDQSxFQUFBLGdDQUVBLEtBQUEsU0FBQSxHQUNBLEdBQUEsS0FHQSxHQUFBLEVBQUEsT0FBQSxRQUFBLEtBQUEsNkNBQUEsS0FBQSxTQUFBLEVBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxHQUFBLEtBQUEsS0FBQSxPQUNBLEVBQUEsRUFBQSxNQUFBLHVCQUNBLEdBQUEsTUFDQSxVQUFBLEVBQ0EsS0FBQSxFQUFBLEdBQ0EsSUFBQSxFQUFBLEdBQUEsS0FBQSxLQUFBLEtBQUEsUUFDQSxLQUFBLEVBQUEsR0FDQSxVQUFBLEVBQUEsT0FHQSxhQUFBLFFBQUEsS0FBQSxVQUFBLEdBQ0EsRUFBQSxJQUNBLFdBQ0EsRUFBQSxnQ0FLQSxHQUFBLFVBQUEsV0FDQSxJQUNBLEtBQUEsU0FBQSxHQUNBLEVBQUEsT0FBQSxFQUNBLEVBQUEsVUFBQSxFQUVBLEVBQUEsNEJBRUEsRUFBQSxXQUFBLDJCQUNBLEVBRUEsSUFBQSxHQUFBLFNBQUEsR0FDQSxFQUFBLE9BQ0EsTUFBQSxTQUNBLFNBQUEsSUFFQSxFQUFBLFdBQUEsK0JDbEVBLElBQUEsV0FBQSxzQkFDQSxTQUFBLGNBQUEsV0FBQSxnQkFBQSxhQUFBLGlCQUFBLFlBQUEsS0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0E2Q0EsR0EzQ0EsRUFBQSxVQUFBLEVBQ0EsRUFBQSxVQUFBLEVBQ0EsRUFBQSxxQkFBQSxTQUFBLEdBQ0EsRUFBQSxtQkFHQSxFQUFBLFNBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxRQUVBLE9BQUEsUUFBQSxHQUFBLE9BQUEsRUFBQSxPQUNBLFFBR0EsT0FBQSxHQUFBLE9BQUEsRUFBQSxJQUFBLEVBQUEsS0FBQSxPQUNBLFdBR0EsT0FBQSxHQUFBLEVBQ0EsV0FEQSxRQUtBLEVBQUEsZUFBQSxTQUFBLEVBQUEsR0FDQSxHQUFBLEdBQUEsU0FDQSxFQUFBLElBQ0EsS0FDQSxHQUFBLEdBQUEsRUFBQSxNQUFBLEtBQUEsR0FBQSxNQUFBLEtBQ0EsRUFBQSxTQUFBLEVBQUEsSUFDQSxFQUFBLFNBQUEsRUFBQSxHQUVBLEdBQUEsT0FBQSxHQUFBLEtBQUEsR0FBQSxPQUFBLEdBQ0EsTUFBQSxHQUNBLEVBQUEsT0FBQSxHQUdBLE1BQUEsR0FBQSxFQUNBLFdBREEsUUFLQSxFQUFBLFlBQUEsRUFDQSxFQUFBLFlBRUEsYUFBQSxPQUNBLElBQ0EsS0FBQSxNQUFBLGFBQUEsUUFBQSxPQUFBLElBQ0EsRUFBQSxZQUFBLEVBQ0EsRUFBQSxTQUFBLEtBQUEsTUFBQSxhQUFBLFNBRUEsTUFBQSxJQUtBLEdBQUEsR0FBQSxTQUFBLEdBQ0EsR0FBQSxLQWdCQSxPQWZBLEdBQUEsR0FBQSxLQUFBLE1BQUEsS0FBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsTUFBQSxLQUFBLEtBQ0EsR0FBQSxHQUNBLEVBQUEsTUFDQSxLQUFBLEVBQUEsR0FBQSxHQUFBLE9BQ0EsS0FBQSxFQUFBLEdBQUEsR0FBQSxPQUNBLE1BQUEsRUFBQSxHQUFBLEdBQUEsT0FDQSxPQUFBLEVBQUEsR0FBQSxHQUFBLE9BQUEsTUFBQSxLQUFBLEdBQ0EsS0FBQSxFQUFBLEdBQUEsR0FBQSxPQUFBLE1BQUEsS0FBQSxHQUNBLFFBQUEsRUFBQSxHQUFBLEdBQUEsT0FDQSxLQUFBLEVBQUEsR0FBQSxHQUFBLE9BQ0EsU0FBQSxFQUFBLEdBQUEsR0FBQSxXQUlBLEdBR0EsRUFBQSxXQUNBLE1BQUEsR0FBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLGFBQ0EsS0FBQSxXQUNBLE1BQUEsR0FBQSxJQUFBLElBQUEsUUFDQSxXQUVBLEVBQUEsZ0NBR0EsS0FBQSxTQUFBLEdBQ0EsTUFBQSxHQUFBLE1BQ0EsRUFBQSxFQUFBLFFBQUEsS0FBQSxnQ0FBQSxLQUFBLFVBRUEsV0FDQSxFQUFBLGdDQUVBLEtBQUEsU0FBQSxHQUNBLEdBQUEsTUFDQSxFQUFBLEVBQUEsTUFLQSxPQUpBLEdBQUEsRUFBQSxFQUFBLFFBQUEsa0JBQUEsS0FBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLEVBQUEsTUFBQSxFQUFBLFFBRUEsRUFBQSxjQUFBLHdDQUNBLEVBQUEsSUFBQSxlQUFBLG9CQUFBLE9BQUEsR0FBQSxJQUNBLFdBQ0EsRUFBQSx3QkFFQSxLQUFBLFNBQUEsR0FDQSxRQUFBLElBQUEsRUFDQSxJQUFBLEdBQUEsRUFBQSxFQUFBLFFBQUEsS0FBQSxTQUNBLEVBQUEsRUFBQSxFQUFBLEdBQUEsR0FBQSxRQUNBLEVBQUEsRUFBQSxFQUFBLEdBQUEsR0FBQSxRQUNBLEVBQUEsRUFBQSxPQUFBLEVBQ0EsY0FBQSxPQUFBLEtBQUEsVUFBQSxFQUFBLFNBQUEsSUFDQSxhQUFBLFdBQUEsU0FBQSxPQUFBLHVCQUNBLEdBQUEsT0FBQSxLQUFBLE1BQUEsYUFBQSxRQUFBLFdBQUEsYUFBQSxjQUNBLFdBQ0EsRUFBQSxrQ0FLQSxHQUFBLFVBQUEsV0FDQSxJQUNBLEtBQUEsU0FBQSxHQUNBLFFBQUEsSUFBQSxHQUNBLEVBQUEsV0FBQSwwQkFDQSxFQUFBLGdCQUNBLEVBQUEsT0FBQSxPQUFBLEdBQ0EsRUFBQSxZQUFBLEVBQ0EsRUFBQSxTQUFBLEVBQUEsUUFFQSxFQUFBLHNCQUVBLEVBRUEsSUFBQSxHQUFBLFNBQUEsR0FDQSxFQUFBLE9BQ0EsTUFBQSxTQUNBLFNBQUEsSUFFQSxFQUFBLFdBQUEiLCJmaWxlIjoid3d3L2pzL2NvbXBpbGVkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBCSU5VU01BWUEgTU9EVUxFXG4gKiBAYXV0aG9yIFBlZG94IDxuYXVmYWxAbWFydGFiYWthbmcudXM+XG4gKi9cblxuXG4vLyBhbmd1bGFyLm1vZHVsZSBpcyBhIGdsb2JhbCBwbGFjZSBmb3IgY3JlYXRpbmcsIHJlZ2lzdGVyaW5nIGFuZCByZXRyaWV2aW5nIEFuZ3VsYXIgbW9kdWxlc1xuLy8gJ3N0YXJ0ZXInIGlzIHRoZSBuYW1lIG9mIHRoaXMgYW5ndWxhciBtb2R1bGUgZXhhbXBsZSAoYWxzbyBzZXQgaW4gYSA8Ym9keT4gYXR0cmlidXRlIGluIGluZGV4Lmh0bWwpXG4vLyB0aGUgMm5kIHBhcmFtZXRlciBpcyBhbiBhcnJheSBvZiAncmVxdWlyZXMnXG5cbnZhciB2aWV3X3BhdGggPSAndmlld3MvJyxcbiAgcGNvbG9yID0gJyMxQzUzNkYnLFxuICBfYmltYXlfdXJsID0gJ2h0dHA6Ly9iaW51c21heWEuYmludXMuYWMuaWQnLFxuICBfYmltYXlfYXBpX3VybCA9ICdodHRwOi8vYXBwcy5iaW51c21heWEuYmludXMuYWMuaWQnO1xuXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ0JpbnVzTWF5YScsIFsnaW9uaWMnLCAnbGlzdFJvdXRlJywgJ0JpbnVzTWF5YUZhY3RvcnknXSlcblxuLnJ1bihmdW5jdGlvbigkaW9uaWNQbGF0Zm9ybSwgJHJvb3RTY29wZSwgJGlvbmljSGlzdG9yeSwgJGlvbmljTmF2QmFyRGVsZWdhdGUsIEJpbnVzTWF5YSkge1xuXG4gICRyb290U2NvcGUubG9naW4gPSAodHlwZW9mIGxvY2FsU3RvcmFnZS5pc2xvZ2luID09IFwidW5kZWZpbmVkXCIgPyBmYWxzZSA6IGxvY2FsU3RvcmFnZS5pc2xvZ2luKTtcbiAgJHJvb3RTY29wZS5sZWZ0TWVudSA9IGZhbHNlO1xuICAkcm9vdFNjb3BlLmxvZ2luTmFtZSA9IHR5cGVvZiBsb2NhbFN0b3JhZ2UuZm5hbWUgPT0gXCJ1bmRlZmluZWRcIiA/IG51bGwgOiBsb2NhbFN0b3JhZ2UuZm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgJHJvb3RTY29wZS5wcm9maWxlSW1hZ2UgPSB0eXBlb2YgbG9jYWxTdG9yYWdlLnByb2ZpbGVJbWFnZSA9PSBcInVuZGVmaW5lZFwiID8gZmFsc2UgOiBsb2NhbFN0b3JhZ2UucHJvZmlsZUltYWdlO1xuICBkZWxldGUgbG9jYWxTdG9yYWdlLmNvb2tpZTtcbiAgZGVsZXRlIGxvY2FsU3RvcmFnZS50ZW1wbG9naW47XG5cbiAgJGlvbmljUGxhdGZvcm0ucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgJHJvb3RTY29wZS5vbkxvYWRTdHlsZSA9IHtcbiAgICAgIG9wYWNpdHk6IDFcbiAgICB9O1xuICAgIC8vIEhpZGUgdGhlIGFjY2Vzc29yeSBiYXIgYnkgZGVmYXVsdCAocmVtb3ZlIHRoaXMgdG8gc2hvdyB0aGUgYWNjZXNzb3J5IGJhciBhYm92ZSB0aGUga2V5Ym9hcmRcbiAgICAvLyBmb3IgZm9ybSBpbnB1dHMpXG4gICAgaWYgKHdpbmRvdy5jb3Jkb3ZhICYmIHdpbmRvdy5jb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQpIHtcbiAgICAgIGNvcmRvdmEucGx1Z2lucy5LZXlib2FyZC5oaWRlS2V5Ym9hcmRBY2Nlc3NvcnlCYXIodHJ1ZSk7XG4gICAgfVxuICAgIGlmICh3aW5kb3cuU3RhdHVzQmFyKSB7XG4gICAgICBTdGF0dXNCYXIuc3R5bGVEZWZhdWx0KCk7XG4gICAgfVxuICB9KTtcblxuICAkcm9vdFNjb3BlLmdldExhc3RVcGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAkcm9vdFNjb3BlLmxhc3RVcGRhdGUgPSB0eXBlb2YgbG9jYWxTdG9yYWdlLmxhc3RVcGRhdGUgPT09IFwidW5kZWZpbmVkXCIgPyBcIldoYXRldmVyXCIgOiBsb2NhbFN0b3JhZ2UubGFzdFVwZGF0ZTtcbiAgfTtcbiAgJHJvb3RTY29wZS5nZXRMYXN0VXBkYXRlKCk7XG4gICRyb290U2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgbG9jYWxTdG9yYWdlLmNsZWFyKCk7XG4gICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAnIy8nO1xuICAgICRpb25pY0hpc3RvcnkuY2xlYXJIaXN0b3J5KCk7XG4gICAgJGlvbmljTmF2QmFyRGVsZWdhdGUuc2hvd0JhY2tCdXR0b24oZmFsc2UpO1xuICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICB9O1xuXG4gICRyb290U2NvcGUuZ2V0UHJvZmlsZUltYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgLyoqIHBlZm9ybSBhdmF0YXIgKiovXG4gICAgQmludXNNYXlhLmdldFByb2ZpbGVJbWFnZShcbiAgICAgIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnByb2ZpbGVJbWFnZSA9IGRvbmU7XG4gICAgICAgICRyb290U2NvcGUucHJvZmlsZUltYWdlID0gZG9uZTtcbiAgICAgIH0sXG4gICAgICBmdW5jdGlvbigpIHtcblxuICAgICAgfSk7XG4gIH07XG5cbiAgaWYgKCRyb290U2NvcGUubG9naW4pIHtcbiAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9ICcvc2NoZWR1bGUnO1xuICB9IGVsc2Uge1xuICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gJy8nO1xuICB9XG59KVxuXG4uY29uZmlnKGZ1bmN0aW9uKCRpb25pY0NvbmZpZ1Byb3ZpZGVyKSB7XG4gICRpb25pY0NvbmZpZ1Byb3ZpZGVyLnZpZXdzLmZvcndhcmRDYWNoZShmYWxzZSk7XG4gICRpb25pY0NvbmZpZ1Byb3ZpZGVyLnZpZXdzLm1heENhY2hlKDApO1xufSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnQmludXNNYXlhRmFjdG9yeScsIFtdKVxuXG4uZmFjdG9yeSgnQmludXNNYXlhJywgZnVuY3Rpb24oJHEpIHtcbiAgcmV0dXJuIHtcblxuICAgIF9iaW1heV91cmw6ICdodHRwOi8vYmludXNtYXlhLmJpbnVzLmFjLmlkJyxcbiAgICBfYmltYXlfYXBpX3VybDogJ2h0dHA6Ly9hcHBzLmJpbnVzbWF5YS5iaW51cy5hYy5pZCcsXG5cbiAgICBoZWFkZXJzOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBfdCA9IHRoaXM7XG4gICAgICByZXR1cm4gIHtcbiAgICAgICAgQ29va2llOiBsb2NhbFN0b3JhZ2UuY29va2llID8gbG9jYWxTdG9yYWdlLmNvb2tpZSA6IG51bGwsXG4gICAgICAgIE9yaWdpbjogX3QuX2JpbWF5X3VybCxcbiAgICAgICAgUmVmZXJlcjogX3QuX2JpbWF5X3VybFxuICAgICAgfTtcbiAgICB9LFxuICAgIGNoZWNrTG9naW46IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIF90ID0gdGhpcztcbiAgICAgIHZhciBsb2dpbiA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmxvZ2luSWQpO1xuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBpZihsb2NhbFN0b3JhZ2UudGVtcGxvZ2luID09PSB0cnVlKSB7XG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gX3QuYXBpKCcvJywgJ2dldCcpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgaWYoZC5jb2RlICE9PSAyMDApIHJlamVjdChkKTtcbiAgICAgICAgICAgIHZhciBkYXRhID0ge307XG4gICAgICAgICAgICAkKCQoZC5yZXN1bHQpLnNlcmlhbGl6ZUFycmF5KCkpLmVhY2goZnVuY3Rpb24oaSwgZCkge1xuICAgICAgICAgICAgICBkYXRhW2QubmFtZV0gPSBkLnZhbHVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkYXRhLnR4dFVzZXJJZCA9IGxvZ2luLmJpbnVzaWQ7XG4gICAgICAgICAgICBkYXRhLnR4dFBhc3N3b3JkID0gbG9naW4ucGFzc3dvcmQ7XG4gICAgICAgICAgICBkYXRhLmJ0bkxvZ2luID0gXCJMb2cgSW4gXCI7XG4gICAgICAgICAgICByZXR1cm4gX3QuYXBpKCcvJywgJ3Bvc3QnLCBkYXRhKTtcbiAgICAgICAgICB9LCByZWplY3QpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnRlbXBsb2dpbiA9IHRydWU7XG4gICAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXBpOiBmdW5jdGlvbihlbmRwb2ludCwgbWV0aG9kLCBwYXJhbXMsIG5vRW5kcG9pbnQpIHtcbiAgICAgIHZhciBfdCA9IHRoaXM7XG4gICAgICB0eXBlb2Ygbm9FbmRwb2ludCAhPT0gXCJ1bmRlZmluZWRcIiA/IGZhbHNlIDogdHJ1ZTtcbiAgICAgIGlmIChsb2NhbFN0b3JhZ2UuY29va2llID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIF90Ll9nZXRDb29raWUoKVxuICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gX3QuYXBpKGVuZHBvaW50LCBtZXRob2QsIHBhcmFtcyk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIGlmIChtZXRob2QgPT09IFwiZ2V0XCIpIHtcbiAgICAgICAgICAgIGh0dHBjbGllbnQuZ2V0KChub0VuZHBvaW50ID8gZW5kcG9pbnQgOiBfdC5fYmltYXlfdXJsICsgZW5kcG9pbnQpLCByZXNvbHZlLCByZWplY3QsIHtcbiAgICAgICAgICAgICAgaGVhZGVyczogX3QuaGVhZGVycygpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaHR0cGNsaWVudC5wb3N0KChub0VuZHBvaW50ID8gZW5kcG9pbnQgOiBfdC5fYmltYXlfdXJsICsgZW5kcG9pbnQpLCBwYXJhbXMsIHJlc29sdmUsIHJlamVjdCwge1xuICAgICAgICAgICAgICBoZWFkZXJzOiBfdC5oZWFkZXJzKClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGZyYW1lOiBmdW5jdGlvbih1cmwpIHtcbiAgICAgIHZhciBfdCA9IHRoaXMsXG4gICAgICAgICBfdXJsID0gJyc7XG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHJldHVybiBfdC5hcGkodXJsLCAnZ2V0JylcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oZCkge1xuICAgICAgICAgIHJldHVybiBfdC5hcGkoJChkLnJlc3VsdCkuZmluZChcIiNjdGwwMF9jcDFfaWZyQXBwXCIpLmF0dHIoXCJzcmNcIiksICdnZXQnKTtcbiAgICAgICAgfSwgcmVqZWN0KVxuICAgICAgICAudGhlbihmdW5jdGlvbihkKSB7XG4gICAgICAgICAgX3VybCA9ICQoZC5yZXN1bHQpLmZpbmQoXCIjaWZyQXBwXCIpLmF0dHIoXCJzcmNcIik7XG4gICAgICAgICAgcmV0dXJuIF90LmFwaShfdXJsLCAnZ2V0Jywge30sIHRydWUpO1xuICAgICAgICB9LCByZWplY3QpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgIHVybDogX3VybCxcbiAgICAgICAgICAgIHJlc3VsdDogZFxuICAgICAgICAgIH0pO1xuICAgICAgICB9LCByZWplY3QpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIF9nZXRDb29raWU6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIF90ID0gdGhpcztcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgaHR0cGNsaWVudC5nZXQoX3QuX2JpbWF5X3VybCwgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIGlmIChkYXRhLmNvZGUgPT0gMjAwKSB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UuY29va2llID0gZGF0YS5oZWFkZXJbJ1NldC1Db29raWUnXTtcbiAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlamVjdChkYXRhKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHJlc29sdmUpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBfcmVxdWVzdEVycm9yOiBmdW5jdGlvbihkYXRhKSB7XG5cbiAgICB9LFxuICAgIGdyb3VwaW5nOiBmdW5jdGlvbihfZGF0YSkge1xuXHRcdFx0aWYoX2RhdGEubGVuZ3RoIDw9IDApIHtcblx0XHRcdFx0cmV0dXJuIFtdO1xuXHRcdFx0fVxuXHRcdFx0dmFyIG0gPSBbXSxcblx0XHRcdFx0cCA9ICcnLFxuXHRcdFx0XHRjID0gLTEsXG5cdFx0XHRcdGNoID0gMDtcblx0XHRcdF9kYXRhLmZvckVhY2goZnVuY3Rpb24oZCxpKSB7XG5cdFx0XHRcdGlmKHAgPT0gZC5kYXRlKSB7XG5cdFx0XHRcdFx0bVtjXS5kYXRhW2NoXSA9IGQ7IGNoKys7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y2ggPSAxOyBjKys7IHAgPSBkLmRhdGU7XG5cdFx0XHRcdFx0bVtjXSA9IHtkYXRlOiBkLmRhdGUsIGRhdGE6IFtdfTtcblx0XHRcdFx0XHRtW2NdLmRhdGFbMF0gPSBkO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiBtO1xuXHRcdH1cbiAgfTtcbn0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2xpc3RSb3V0ZScsIFtdKVxuXG4uY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJywgZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuICAkc3RhdGVQcm92aWRlclxuICAgIC5zdGF0ZSgnaW5kZXgnLCB7XG4gICAgICB1cmw6ICcvJyxcbiAgICAgIHZpZXdzOiB7XG4gICAgICAgICdtYWluLXZpZXcnOiB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6IHZpZXdfcGF0aCArICdsb2dpbi5odG1sJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgICAuc3RhdGUoJ3NjaGVkdWxlJywge1xuICAgICAgdXJsOiAnL3NjaGVkdWxlJyxcbiAgICAgIHZpZXdzOiB7XG4gICAgICAgICdtYWluLXZpZXcnOiB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6IHZpZXdfcGF0aCArICdzY2hlZHVsZS5odG1sJyxcbiAgICAgICAgICBjb250cm9sbGVyOiAnU2NoZWR1bGVDb250cm9sbGVyJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgICAuc3RhdGUoJ2Fib3V0Jywge1xuICAgICAgdXJsOiAnL2Fib3V0JyxcbiAgICAgIHZpZXdzOiB7XG4gICAgICAgICdtYWluLXZpZXcnOiB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6IHZpZXdfcGF0aCArICdhYm91dC5odG1sJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgICAuc3RhdGUoJ2ZvcnVtJywge1xuICAgICAgdXJsOiAnL2ZvcnVtJyxcbiAgICAgIHZpZXdzOiB7XG4gICAgICAgICdtYWluLXZpZXcnOiB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6IHZpZXdfcGF0aCArICdmb3J1bS5odG1sJyxcbiAgICAgICAgICBjb250cm9sbGVyOiAnRm9ydW1Db250cm9sbGVyJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgICAuc3RhdGUoJ3NlcnZpY2VzJywge1xuICAgICAgdXJsOiAnL3NlcnZpY2VzJyxcbiAgICAgIHZpZXdzOiB7XG4gICAgICAgICdtYWluLXZpZXcnOiB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6IHZpZXdfcGF0aCArICdzZXJ2aWNlcy9pbmRleC5odG1sJyxcbiAgICAgICAgICBjb250cm9sbGVyOiAnU2VydmljZXNDb250cm9sbGVyJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgICAuc3RhdGUoJ215Y2xhc3MnLCB7XG4gICAgICB1cmw6ICcvbXljbGFzcycsXG4gICAgICB2aWV3czoge1xuICAgICAgICAnbWFpbi12aWV3Jzoge1xuICAgICAgICAgIHRlbXBsYXRlVXJsOiB2aWV3X3BhdGggKyAnbXljbGFzcy5odG1sJyxcbiAgICAgICAgICBjb250cm9sbGVyOiAnTXlDbGFzc0NvbnRyb2xsZXInXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgnbXljbGFzc0RldGFpbCcsIHtcbiAgICAgIHVybDogJy9teWNsYXNzLWRldGFpbC86Y29kZScsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIGRhdGFzZXQ6IGZ1bmN0aW9uKCRxLCAkc3RhdGVQYXJhbXMsICRsb2NhdGlvbikge1xuICAgICAgICAgIHZhciBfZ290ID0gZmFsc2U7XG4gICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICB2YXIgY2xhc3NEYXRhID0gKHR5cGVvZiBsb2NhbFN0b3JhZ2UubXlDbGFzcyAhPT0gXCJ1bmRlZmluZWRcIiA/IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLm15Q2xhc3MpIDogZmFsc2UpO1xuICAgICAgICAgIGZvciAodmFyIGQgaW4gY2xhc3NEYXRhKSB7XG4gICAgICAgICAgICBpZiAoY2xhc3NEYXRhW2RdLmNvZGUgPT0gJHN0YXRlUGFyYW1zLmNvZGUpIHtcbiAgICAgICAgICAgICAgX2dvdCA9IGQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChfZ290KSB7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKF9nb3QpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL215Y2xhc3MnKS5yZXBsYWNlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdmlld3M6IHtcbiAgICAgICAgJ21haW4tdmlldyc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogdmlld19wYXRoICsgJ215Y2xhc3NJbnNpZGUuaHRtbCcsXG4gICAgICAgICAgY29udHJvbGxlcjogJ015Q2xhc3NEZXRhaWxDb250cm9sbGVyJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgICAuc3RhdGUoJ2V4YW1TY2hlZHVsZScsIHtcbiAgICAgIHVybDogJy9leGFtLXNjaGVkdWxlJyxcbiAgICAgIHZpZXdzOiB7XG4gICAgICAgICdtYWluLXZpZXcnOiB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6IHZpZXdfcGF0aCArICdzZXJ2aWNlcy9leGFtLXNjaGVkdWxlLmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdFeGFtU2NoZWR1bGVDb250cm9sbGVyJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgICAuc3RhdGUoJ2V4YW1TY29yZScsIHtcbiAgICAgIHVybDogJy9leGFtLXNjb3JlJyxcbiAgICAgIHZpZXdzOiB7XG4gICAgICAgICdtYWluLXZpZXcnOiB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6IHZpZXdfcGF0aCArICdzZXJ2aWNlcy9leGFtLXNjb3JlLmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdFeGFtU2NvcmVDb250cm9sbGVyJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgICAuc3RhdGUoJ2ZpbmFuY2VTdGF0dXMnLCB7XG4gICAgICB1cmw6ICcvZmluYW5jZS1zdGF0dXMnLFxuICAgICAgdmlld3M6IHtcbiAgICAgICAgJ21haW4tdmlldyc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogdmlld19wYXRoICsgJ3NlcnZpY2VzL2JpbGxpbmcuaHRtbCcsXG4gICAgICAgICAgY29udHJvbGxlcjogJ0ZpbmFuY2VDb250cm9sbGVyJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgICAuc3RhdGUoJ2Fic2VuY2UnLCB7XG4gICAgICB1cmw6ICcvYWJzZW5jZScsXG4gICAgICB2aWV3czoge1xuICAgICAgICAnbWFpbi12aWV3Jzoge1xuICAgICAgICAgIHRlbXBsYXRlVXJsOiB2aWV3X3BhdGggKyAnc2VydmljZXMvYWJzZW5jZS5odG1sJyxcbiAgICAgICAgICBjb250cm9sbGVyOiAnQWJzZW5jZUNvbnRyb2xsZXInXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgnY29taW5nJywge1xuICAgICAgdXJsOiAnL2NvbWluZycsXG4gICAgICB2aWV3czoge1xuICAgICAgICAnbWFpbi12aWV3Jzoge1xuICAgICAgICAgIHRlbXBsYXRlVXJsOiB2aWV3X3BhdGggKyAnY29taW5nLmh0bWwnXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL2NvbWluZ1wiKTtcbn1dKTtcbiIsImFwcC5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLFxuZnVuY3Rpb24oJHNjb3BlLCAkaW9uaWNQb3B1cCwgJHRpbWVvdXQsICRpb25pY0hpc3RvcnksICRpb25pY05hdkJhckRlbGVnYXRlLCAkcm9vdFNjb3BlLCBCaW51c01heWEpIHtcblxuICAgICRyb290U2NvcGUubm9IZWFkZXIgPSB0cnVlO1xuICAgICRpb25pY05hdkJhckRlbGVnYXRlLnNob3dCYXIoZmFsc2UpO1xuXG4gICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAkc2NvcGUubG9naW5DbGFzcyA9ICcnO1xuXG4gICAgJGlvbmljSGlzdG9yeS5uZXh0Vmlld09wdGlvbnMoe1xuICAgICAgZGlzYWJsZUJhY2s6IHRydWVcbiAgICB9KTtcblxuICAgICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICghKCRzY29wZS5iaW51c2lkICYmICRzY29wZS5wYXNzd29yZCkpIHtcbiAgICAgICAgJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgIHRpdGxlOiAnT29wcyAhJyxcbiAgICAgICAgICB0ZW1wbGF0ZTogJ1BsZWFzZSBJbnB1dCBCaW51c2lhbiBJRCBhbmQgUGFzc3dvcmQnXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLmxvZ2luQ2xhc3MgPSAnb24tbG9hZGluZyc7XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgQmludXNNYXlhLmFwaSgnLycsICdnZXQnKVxuICAgICAgICAudGhlbihmdW5jdGlvbihkKSB7XG4gICAgICAgICAgaWYoZC5jb2RlICE9PSAyMDApIGhhbmRsZUVycm9yKGQpO1xuICAgICAgICAgIHZhciBkYXRhID0ge307XG4gICAgICAgICAgJCgkKGQucmVzdWx0KS5zZXJpYWxpemVBcnJheSgpKS5lYWNoKGZ1bmN0aW9uKGksIGQpIHtcbiAgICAgICAgICAgIGRhdGFbZC5uYW1lXSA9IGQudmFsdWU7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZGF0YS50eHRVc2VySWQgPSAkc2NvcGUuYmludXNpZDtcbiAgICAgICAgICBkYXRhLnR4dFBhc3N3b3JkID0gJHNjb3BlLnBhc3N3b3JkO1xuICAgICAgICAgIGRhdGEuYnRuTG9naW4gPSBcIkxvZyBJbiBcIjtcbiAgICAgICAgICByZXR1cm4gQmludXNNYXlhLmFwaSgnLycsICdwb3N0JywgZGF0YSk7XG4gICAgICAgIH0sIGhhbmRsZUVycm9yKVxuICAgICAgICAudGhlbihmdW5jdGlvbihkKSB7XG4gICAgICAgICAgdmFyIG5hbWUgPSAkKGQucmVzdWx0KS5maW5kKFwiI2NvbnRlbnQgI3RvcGJhciAucmlnaHQgc3Ryb25nXCIpO1xuICAgICAgICAgIC8vIFdoZW4gU3VjY2Vzc1xuICAgICAgICAgIGlmKGQuY29kZSAhPT0gMjAwKVxuICAgICAgICAgICAgaGFuZGxlRXJyb3IoZCk7XG4gICAgICAgICAgaWYobmFtZS5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgaGFuZGxlRXJyb3IoZCwgJChkLnJlc3VsdCkuZmluZChcIiNsYmxFcnJvclwiKS50ZXh0KCkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLmxvZ2luQ2xhc3MgPSAnJztcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBJIFRoaW5rIHRoYXQgbm90IGJlc3QgbWV0aG9kXG4gICAgICAgICAgICAgKiBAdG9kbyBtYWtlIGl0IGhhc2hcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmxvZ2luSWQgPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIGJpbnVzaWQ6ICRzY29wZS5iaW51c2lkLFxuICAgICAgICAgICAgICBwYXNzd29yZDogJHNjb3BlLnBhc3N3b3JkXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmlzbG9naW4gPSB0cnVlO1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmZuYW1lID0gbmFtZS50ZXh0KCk7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLmxvZ2luID0gdHJ1ZTtcbiAgICAgICAgICAgICRyb290U2NvcGUubG9naW5OYW1lID0gbG9jYWxTdG9yYWdlLmZuYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAkc2NvcGUubG9naW5DbGFzcyA9ICcnO1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gJyMvc2NoZWR1bGUnO1xuICAgICAgICAgICAgJGlvbmljSGlzdG9yeS5jbGVhckhpc3RvcnkoKTtcbiAgICAgICAgICAgICRpb25pY05hdkJhckRlbGVnYXRlLnNob3dCYWNrQnV0dG9uKGZhbHNlKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfSwgaGFuZGxlRXJyb3IpO1xuXG4gICAgICAgIHZhciBoYW5kbGVFcnJvciA9IGZ1bmN0aW9uKGRhdGEsIHRleHQpIHtcbiAgICAgICAgICB0eXBlb2YgdGV4dCAhPT0gXCJ1bmRlZmluZWRcIiA/IHRleHQgOiBudWxsO1xuICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgJHNjb3BlLmxvZ2luQ2xhc3MgPSAnJztcbiAgICAgICAgICAkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgICB0aXRsZTogJ09vcHMgIScsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogdGV4dCA/IHRleHQgOiAnU29tZXRoaW5nIHdyb25nICEnXG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfTtcbiAgfVxuKTtcbiIsIi8qKlxuICogTXkgQ2xhc3MgQ29udHJvbGxlclxuICogQGF1dGhvciBOYXVmYWwgPG5hdWZhbEBtYXJ0YWJha2FuZy51cz5cbiAqL1xuYXBwLmNvbnRyb2xsZXIoJ015Q2xhc3NDb250cm9sbGVyJyxcbiAgZnVuY3Rpb24oJHNjb3BlLCBCaW51c01heWEsICRpb25pY05hdkJhckRlbGVnYXRlLCAkc3RhdGUsICRsb2NhdGlvbiwgJHN0YXRlUGFyYW1zLCAkdGltZW91dCwgJHJvb3RTY29wZSwgJGlvbmljUGxhdGZvcm0sICRxLCAkaW9uaWNQb3B1cCkge1xuICAgICRyb290U2NvcGUubm9IZWFkZXIgPSBmYWxzZTtcbiAgICAkcm9vdFNjb3BlLmxlZnRNZW51ID0gdHJ1ZTtcbiAgICAkaW9uaWNQbGF0Zm9ybS5vbkhhcmR3YXJlQmFja0J1dHRvbihmdW5jdGlvbihlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuY2xhc3NEYXRhID0gKHR5cGVvZiBsb2NhbFN0b3JhZ2UubXlDbGFzcyAhPT0gXCJ1bmRlZmluZWRcIiA/IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLm15Q2xhc3MpIDogZmFsc2UpO1xuXG4gICAgdmFyIHJlZnJlc2hNeUNsYXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIEJpbnVzTWF5YS5jaGVja0xvZ2luKClcbiAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBCaW51c01heWEuYXBpKCcvJywgJ2dldCcpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gRmFpbCB0byByZS1sb2dpblxuICAgICAgICAgICAgcmVqZWN0KFwiY2FuJ3QgcmUtYXV0aCB5b3VyIGFjY291bnRcIik7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAvLyBMb2FkIFRoZXNlIFBhZ2VcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICByZXR1cm4gQmludXNNYXlhLmZyYW1lKFxuICAgICAgICAgICAgICAkKGQucmVzdWx0KS5maW5kKFwiLml0ZW1Db250ZW50IHVsIGxpOmVxKDApID4gYVwiKS5hdHRyKFwiaHJlZlwiKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJlamVjdChcImNhbid0IGFjY2VzcyB0byBtYWluIGZyYW1lXCIpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oYykge1xuICAgICAgICAgICAgdmFyIF9yZURhdGEgPSBbXSxcbiAgICAgICAgICAgICAgX3Byb21pc2VzWW91ID0gW10sXG4gICAgICAgICAgICAgIF9wcm9taXNlc0NvdW50ID0gMDtcbiAgICAgICAgICAgICQoYy5yZXN1bHQucmVzdWx0KS5maW5kKFwiI2N0bDAwX0NvbnRlbnRQbGFjZUhvbGRlcjFfcG5sVGVvcmkgdWwgbGlcIikuZWFjaChmdW5jdGlvbihpLCBkKSB7XG4gICAgICAgICAgICAgIHZhciBuYW1lID0gJChkKS5maW5kKFwiYVwiKS5odG1sKCksXG4gICAgICAgICAgICAgICAgICByZWcgPSBuYW1lLm1hdGNoKC9eKC4qKS0oLiopIFxcKCguKilcXCkvaSk7XG4gICAgICAgICAgICAgIF9yZURhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgaW5kZXhJdGVtOiBpLFxuICAgICAgICAgICAgICAgIG5hbWU6IHJlZ1syXSxcbiAgICAgICAgICAgICAgICB1cmw6ICQoZCkuZmluZChcImFcIikuYXR0cignaHJlZicpLFxuICAgICAgICAgICAgICAgIGNvZGU6IHJlZ1sxXSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHJlZ1szXVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLm15Q2xhc3MgPSBKU09OLnN0cmluZ2lmeShfcmVEYXRhKTtcbiAgICAgICAgICAgIHJlc29sdmUoX3JlRGF0YSk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZWplY3QoXCJjYW4ndCBhY2Nlc3MgdG8gbXkgY2xhc3NcIik7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmRvUmVmcmVzaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmVmcmVzaE15Q2xhc3MoKVxuICAgICAgLnRoZW4oZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICBpZiAoZG9uZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgJHNjb3BlLmNsYXNzRGF0YSA9IGRvbmU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXJySGFuZGxlKFwiWW91IGRvbid0IGhhdmUgYW55IGNsYXNzXCIpO1xuICAgICAgICB9XG4gICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdzY3JvbGwucmVmcmVzaENvbXBsZXRlJyk7XG4gICAgICB9LCBlcnJIYW5kbGUpO1xuXG4gICAgICB2YXIgZXJySGFuZGxlID0gZnVuY3Rpb24obXNnKSB7XG4gICAgICAgICRpb25pY1BvcHVwLmFsZXJ0KHtcbiAgICAgICAgICB0aXRsZTogJ09vcHMgIScsXG4gICAgICAgICAgdGVtcGxhdGU6IG1zZ1xuICAgICAgICB9KTtcbiAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcbiAgICAgIH07XG4gICAgfTtcblxuICB9KTtcbiIsIi8qKlxuICogU2NoZWR1bGUgQ29udHJvbGxlclxuICogQGF1dGhvciBOYXVmYWwgPG5hdWZhbEBtYXJ0YWJha2FuZy51cz5cbiAqL1xuYXBwLmNvbnRyb2xsZXIoJ1NjaGVkdWxlQ29udHJvbGxlcicsXG4gIGZ1bmN0aW9uKCRzY29wZSwgJGlvbmljUG9wdXAsICR0aW1lb3V0LCAkaW9uaWNIaXN0b3J5LCAkcm9vdFNjb3BlLCAkaW9uaWNQbGF0Zm9ybSwgQmludXNNYXlhLCAkcSkge1xuXG4gICAgJHJvb3RTY29wZS5ub0hlYWRlciA9IGZhbHNlO1xuICAgICRyb290U2NvcGUubGVmdE1lbnUgPSB0cnVlO1xuICAgICRpb25pY1BsYXRmb3JtLm9uSGFyZHdhcmVCYWNrQnV0dG9uKGZ1bmN0aW9uKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcblxuICAgICRzY29wZS5nZXRTdGF0ZSA9IGZ1bmN0aW9uKGQpIHtcbiAgICAgIHZhciB0b2RheSA9IG1vbWVudCgpO1xuICAgICAgLy90b2RheVxuICAgICAgaWYgKG1vbWVudChkKS5pc1NhbWUodG9kYXksICdkYXknKSkge1xuICAgICAgICByZXR1cm4gJ3RvZGF5JztcbiAgICAgIH0gZWxzZVxuICAgICAgLy90b21vcnJvd1xuICAgICAgaWYgKG1vbWVudChkKS5pc1NhbWUodG9kYXkuYWRkKDEsICdkJyksICdkYXknKSkge1xuICAgICAgICByZXR1cm4gJ3RvbW9ycm93JztcbiAgICAgIH0gZWxzZVxuICAgICAgLy9sYXN0ZWRcbiAgICAgIGlmIChtb21lbnQoZCkgPCB0b2RheSkge1xuICAgICAgICByZXR1cm4gJ2NvbXBsZXRvJztcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLmdldENvdXJzZVN0YXRlID0gZnVuY3Rpb24oZCwgbSkge1xuICAgICAgdmFyIG5vdyA9IG1vbWVudCgpLFxuICAgICAgICBnZXRNb21lbnQgPSBudWxsO1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIGdldExhc3QgPSBtLnNwbGl0KFwiLVwiKVsxXS5zcGxpdChcIjpcIiksXG4gICAgICAgICAgZ2V0SG91ciA9IHBhcnNlSW50KGdldExhc3RbMF0pLFxuICAgICAgICAgIGdldE1pbnV0ZSA9IHBhcnNlSW50KGdldExhc3RbMV0pO1xuXG4gICAgICAgIGdldE1vbWVudCA9IG1vbWVudChkKS5ob3VyKGdldEhvdXIpLm1pbnV0ZShnZXRNaW51dGUpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBnZXRNb21lbnQgPSBtb21lbnQoZCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChnZXRNb21lbnQgPCBub3cpIHtcbiAgICAgICAgcmV0dXJuICdjb21wbGV0byc7XG4gICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5pc1NjaGVkdWxlID0gZmFsc2U7XG4gICAgJHNjb3BlLnNjaGVkdWxlID0gW107XG5cbiAgICBpZiAobG9jYWxTdG9yYWdlLmphZHdhbCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmphZHdhbCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICRzY29wZS5pc1NjaGVkdWxlID0gdHJ1ZTtcbiAgICAgICAgICAkc2NvcGUuc2NoZWR1bGUgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5qYWR3YWwpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG5cbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgdG9Kc29uID0gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgdmFyIGhhc2lsID0gW107XG4gICAgICAkKGRhdGEpLmZpbmQoJ3RyJykuZWFjaChmdW5jdGlvbihpLCBhKSB7XG4gICAgICAgIHZhciBodCA9ICQodGhpcykuZmluZCgndGQnKTtcbiAgICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgICAgaGFzaWwucHVzaCh7XG4gICAgICAgICAgICBkYXRlOiBodC5lcSgwKS5odG1sKCksXG4gICAgICAgICAgICB0aW1lOiBodC5lcSgxKS5odG1sKCksXG4gICAgICAgICAgICBzdGF0ZTogaHQuZXEoMikuaHRtbCgpLFxuICAgICAgICAgICAgY291cnNlOiBodC5lcSgzKS5odG1sKCkuc3BsaXQoXCItXCIpWzFdLFxuICAgICAgICAgICAgY29kZTogaHQuZXEoMykuaHRtbCgpLnNwbGl0KFwiLVwiKVswXSxcbiAgICAgICAgICAgIG15Q2xhc3M6IGh0LmVxKDUpLmh0bWwoKSxcbiAgICAgICAgICAgIHJvb206IGh0LmVxKDYpLmh0bWwoKSxcbiAgICAgICAgICAgIGJ1aWxkaW5nOiBodC5lcSg3KS5odG1sKClcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gaGFzaWw7XG4gICAgfTtcblxuICAgIHZhciByZWZyZXNoSmFkd2FsID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIEJpbnVzTWF5YS5jaGVja0xvZ2luKClcbiAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBCaW51c01heWEuYXBpKCcvJywgJ2dldCcpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gRmFpbCB0byByZS1sb2dpblxuICAgICAgICAgICAgcmVqZWN0KFwiY2FuJ3QgcmUtYXV0aCB5b3VyIGFjY291bnRcIik7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAvLyBMb2FkIFRoZXNlIFBhZ2VcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICByZXR1cm4gQmludXNNYXlhLmZyYW1lKFxuICAgICAgICAgICAgICAkKGQucmVzdWx0KS5maW5kKFwiLml0ZW1Db250ZW50IHVsIGxpOmVxKDApID4gYVwiKS5hdHRyKFwiaHJlZlwiKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJlamVjdChcImNhbid0IGFjY2VzcyB0byBtYWluIGZyYW1lXCIpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oYykge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSB7fSxcbiAgICAgICAgICAgICAgZCA9IGMucmVzdWx0O1xuICAgICAgICAgICAgJCgkKGQucmVzdWx0KS5zZXJpYWxpemVBcnJheSgpKS5lYWNoKGZ1bmN0aW9uKGksIGQpIHtcbiAgICAgICAgICAgICAgZGF0YVtkLm5hbWVdID0gZC52YWx1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGF0YS5fX0VWRU5UVEFSR0VUID0gJ2N0bDAwJENvbnRlbnRQbGFjZUhvbGRlcjEkYnRuU2NoZWR1bGUnO1xuICAgICAgICAgICAgcmV0dXJuIEJpbnVzTWF5YS5hcGkoX2JpbWF5X2FwaV91cmwgKyAnL0xNUy9NeUNsYXNzLmFzcHgnLCAncG9zdCcsIGRhdGEsIHRydWUpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmVqZWN0KFwiY2FuJ3QgYWNjZXNzIGZyYW1lXCIpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZCk7XG4gICAgICAgICAgICB2YXIgX3NjaGVkdWxlID0gJChkLnJlc3VsdCkuZmluZChcInRhYmxlXCIpLFxuICAgICAgICAgICAgICB0b2RheSA9IHRvSnNvbihfc2NoZWR1bGUuZXEoMCkuaHRtbCgpKSxcbiAgICAgICAgICAgICAgbmV4dCA9IHRvSnNvbihfc2NoZWR1bGUuZXEoMSkuaHRtbCgpKSxcbiAgICAgICAgICAgICAgc2tlZHVsID0gdG9kYXkuY29uY2F0KG5leHQpO1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmphZHdhbCA9IEpTT04uc3RyaW5naWZ5KEJpbnVzTWF5YS5ncm91cGluZyhza2VkdWwpKTtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5sYXN0VXBkYXRlID0gbW9tZW50KCkuZm9ybWF0KCdEIE1NTU0gWVlZWSBoOm1tOnNzJyk7XG4gICAgICAgICAgICByZXNvbHZlKHtqYWR3YWw6IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmphZHdhbCksIGxhc3RVcGRhdGU6IGxvY2FsU3RvcmFnZS5sYXN0VXBkYXRlfSk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZWplY3QoXCJjYW4ndCBhY2Nlc3Mgc2NoZWR1bGUgcGFnZVwiKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZG9SZWZyZXNoID0gZnVuY3Rpb24oKSB7XG4gICAgICByZWZyZXNoSmFkd2FsKClcbiAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdzY3JvbGwucmVmcmVzaENvbXBsZXRlJyk7XG4gICAgICAgICRyb290U2NvcGUuZ2V0TGFzdFVwZGF0ZSgpO1xuICAgICAgICBpZiAoZGF0YS5qYWR3YWwubGVuZ3RoID4gMCkge1xuICAgICAgICAgICRzY29wZS5pc1NjaGVkdWxlID0gdHJ1ZTtcbiAgICAgICAgICAkc2NvcGUuc2NoZWR1bGUgPSBkYXRhLmphZHdhbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlcnJIYW5kbGUoXCJObyBTY2hlZHVsZSBmb3VuZFwiKTtcbiAgICAgICAgfVxuICAgICAgfSwgZXJySGFuZGxlKTtcblxuICAgICAgdmFyIGVyckhhbmRsZSA9IGZ1bmN0aW9uKG1zZykge1xuICAgICAgICAkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgdGl0bGU6ICdPb3BzICEnLFxuICAgICAgICAgIHRlbXBsYXRlOiBtc2dcbiAgICAgICAgfSk7XG4gICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdzY3JvbGwucmVmcmVzaENvbXBsZXRlJyk7XG4gICAgICB9O1xuICAgIH07XG5cbiAgfSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
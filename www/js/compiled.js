var view_path="views/",pcolor="#1C536F",_bimay_url="http://binusmaya.binus.ac.id",_bimay_api_url="http://apps.binusmaya.binus.ac.id",app=angular.module("BinusMaya",["ionic","listRoute","BinusMayaFactory"]).run(["$ionicPlatform","$rootScope","$ionicHistory","$ionicNavBarDelegate","BinusMaya",function(e,t,a,o,n){t.login="undefined"==typeof localStorage.islogin?!1:localStorage.islogin,t.leftMenu=!1,t.loginName="undefined"==typeof localStorage.fname?null:localStorage.fname.toLowerCase(),t.profileImage="undefined"==typeof localStorage.profileImage?!1:localStorage.profileImage,delete localStorage.cookie,delete localStorage.templogin,e.ready(function(){t.onLoadStyle={opacity:1},window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()}),t.getLastUpdate=function(){t.lastUpdate="undefined"==typeof localStorage.lastUpdate?"Whatever":localStorage.lastUpdate},t.getLastUpdate(),t.logout=function(){localStorage.clear(),window.location.hash="#/",a.clearHistory(),o.showBackButton(!1),location.reload()},t.getProfileImage=function(){n.getProfileImage(function(e){localStorage.profileImage=e,t.profileImage=e},function(){})},window.location.hash=t.login?"/schedule":"/"}]).config(["$ionicConfigProvider",function(e){e.views.forwardCache(!1),e.views.maxCache(0)}]);angular.module("BinusMayaFactory",[]).factory("BinusMaya",["$q",function(e){return{_bimay_url:"http://binusmaya.binus.ac.id",_bimay_api_url:"http://apps.binusmaya.binus.ac.id",headers:function(){var e=this;return{Cookie:localStorage.cookie?localStorage.cookie:null,Origin:e._bimay_url,Referer:e._bimay_url}},checkLogin:function(){var t=this,a=JSON.parse(localStorage.loginId);return e(function(e,o){return localStorage.templogin!==!0?t.api("/","get").then(function(e){200!==e.code&&o(e);var n={};return $($(e.result).serializeArray()).each(function(e,t){n[t.name]=t.value}),n.txtUserId=a.binusid,n.txtPassword=a.password,n.btnLogin="Log In ",t.api("/","post",n)},o).then(function(){localStorage.templogin=!0,e(!0)},o):(e(!0),void 0)})},api:function(t,a,o,n){var i=this;return void 0===localStorage.cookie?i._getCookie().then(function(){return i.api(t,a,o)}):e(function(e,l){"get"===a?httpclient.get(n?t:i._bimay_url+t,e,l,{headers:i.headers()}):httpclient.post(n?t:i._bimay_url+t,o,e,l,{headers:i.headers()})})},frame:function(t){var a=this,o="";return e(function(e,n){return a.api(t,"get").then(function(e){return a.api($(e.result).find("#ctl00_cp1_ifrApp").attr("src"),"get")},n).then(function(e){return o=$(e.result).find("#ifrApp").attr("src"),a.api(o,"get",{},!0)},n).then(function(t){e({url:o,result:t})},n)})},_getCookie:function(){var t=this;return e(function(e,a){httpclient.get(t._bimay_url,function(t){200==t.code?(localStorage.cookie=t.header["Set-Cookie"],e(!0)):a(t)},e)})},_requestError:function(){},grouping:function(e){if(e.length<=0)return[];var t=[],a="",o=-1,n=0;return e.forEach(function(e){a==e.date?(t[o].data[n]=e,n++):(n=1,o++,a=e.date,t[o]={date:e.date,data:[]},t[o].data[0]=e)}),t}}}]),angular.module("listRoute",[]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("index",{url:"/",views:{"main-view":{templateUrl:view_path+"login.html"}}}).state("schedule",{url:"/schedule",views:{"main-view":{templateUrl:view_path+"schedule.html",controller:"ScheduleController"}}}).state("about",{url:"/about",views:{"main-view":{templateUrl:view_path+"about.html"}}}).state("forum",{url:"/forum",views:{"main-view":{templateUrl:view_path+"forum.html",controller:"ForumController"}}}).state("services",{url:"/services",views:{"main-view":{templateUrl:view_path+"services/index.html",controller:"ServicesController"}}}).state("myclass",{url:"/myclass",views:{"main-view":{templateUrl:view_path+"myclass.html",controller:"MyClassController"}}}).state("myclassDetail",{url:"/myclass-detail/:code",resolve:{dataset:["$q","$stateParams","$location",function(e,t,a){var o=!1,n=e.defer(),i="undefined"!=typeof localStorage.myClass?JSON.parse(localStorage.myClass):!1;for(var l in i)i[l].code==t.code&&(o=l);return o?n.resolve(o):a.path("/myclass").replace(),n.promise}]},views:{"main-view":{templateUrl:view_path+"myclassInside.html",controller:"MyClassDetailController"}}}).state("examSchedule",{url:"/exam-schedule",views:{"main-view":{templateUrl:view_path+"services/exam-schedule.html",controller:"ExamScheduleController"}}}).state("examScore",{url:"/exam-score",views:{"main-view":{templateUrl:view_path+"services/exam-score.html",controller:"ExamScoreController"}}}).state("financeStatus",{url:"/finance-status",views:{"main-view":{templateUrl:view_path+"services/billing.html",controller:"FinanceController"}}}).state("absence",{url:"/absence",views:{"main-view":{templateUrl:view_path+"services/absence.html",controller:"AbsenceController"}}}).state("coming",{url:"/coming",views:{"main-view":{templateUrl:view_path+"coming.html"}}}),t.otherwise("/coming")}]),app.controller("LoginController",["$scope","$ionicPopup","$timeout","$ionicHistory","$ionicNavBarDelegate","$rootScope","BinusMaya",function(e,t,a,o,n,i,l){i.noHeader=!0,n.showBar(!1),e.loading=!1,e.loginClass="",o.nextViewOptions({disableBack:!0}),e.submit=function(){if(e.binusid&&e.password){e.loginClass="on-loading",e.loading=!0,l.api("/","get").then(function(t){200!==t.code&&a(t);var o={};return $($(t.result).serializeArray()).each(function(e,t){o[t.name]=t.value}),o.txtUserId=e.binusid,o.txtPassword=e.password,o.btnLogin="Log In ",l.api("/","post",o)},a).then(function(t){var l=$(t.result).find("#content #topbar .right strong");200!==t.code&&a(t),l.length<=0?a(t,$(t.result).find("#lblError").text()):(e.loading=!1,e.loginClass="",localStorage.loginId=JSON.stringify({binusid:e.binusid,password:e.password}),localStorage.islogin=!0,localStorage.fname=l.text(),i.login=!0,i.loginName=localStorage.fname.toLowerCase(),e.loginClass="",e.loading=!1,window.location.hash="#/schedule",o.clearHistory(),n.showBackButton(!1))},a);var a=function(a,o){e.loading=!1,e.loginClass="",t.alert({title:"Oops !",template:o?o:"Something wrong !"})}}else t.alert({title:"Oops !",template:"Please Input Binusian ID and Password"})}}]),app.controller("MyClassController",["$scope","BinusMaya","$ionicNavBarDelegate","$state","$location","$stateParams","$timeout","$rootScope","$ionicPlatform","$q","$ionicPopup",function(e,t,a,o,n,i,l,r,s,c,u){r.noHeader=!1,r.leftMenu=!0,s.onHardwareBackButton(function(e){e.preventDefault()}),e.classData="undefined"!=typeof localStorage.myClass?JSON.parse(localStorage.myClass):!1;var d=function(){return c(function(e,a){t.checkLogin().then(function(){return t.api("/","get")},function(){a("can't re-auth your account")}).then(function(e){return t.frame($(e.result).find(".itemContent ul li:eq(0) > a").attr("href"))},function(){a("can't access to main frame")}).then(function(t){var a=[];$(t.result.result).find("#ctl00_ContentPlaceHolder1_pnlTeori ul li").each(function(e,t){var o=$(t).find("a").html(),n=o.match(/^(.*)-(.*) \((.*)\)/i);a.push({indexItem:e,name:n[2],url:$(t).find("a").attr("href"),code:n[1],className:n[3]})}),localStorage.myClass=JSON.stringify(a),e(a)},function(){a("can't access to my class")})})};e.doRefresh=function(){d().then(function(a){a.length>0?e.classData=a:t("You don't have any class"),e.$broadcast("scroll.refreshComplete")},t);var t=function(t){u.alert({title:"Oops !",template:t}),e.$broadcast("scroll.refreshComplete")}}}]),app.controller("MyClassDetailController",["$scope","BinusMaya","$ionicNavBarDelegate","$state","$location","$stateParams","$timeout","$rootScope","$ionicPlatform","$q","$ionicPopup","dataset",function(e,t,a,o,n,i,l,r,s,c,u,d){e.classData="undefined"!=typeof localStorage.myClass?JSON.parse(localStorage.myClass):!1,e.state={isData:!1,loading:!0},e.data=e.classData[d],e.infoTab="active",e.topicsTab="";var m=function(e){return c(function(a,o){t.checkLogin().then(function(){return t.api("/","get")},function(){o("can't re-auth your account")}).then(function(e){return t.frame($(e.result).find(".itemContent ul li:eq(0) > a").attr("href"))},function(){o("can't access to main frame")}).then(function(){return console.log(),t.api(_bimay_api_url+"/LMS/"+e,"get",{},!0)},function(){o("can't access to my class")}).then(function(e){var t=e.result,o=$(t).find("#desc_course_desc > span").html(),n=$(t).find("#desc_grad_compete > span").html(),i=[];$(t).find("#ctl00_ContentPlaceHolder1_pnlContentTheory table tbody tr").each(function(e,t){0!==e&&i.push({session:parseInt($(t).find("td:eq(0) > span").html()),mode:$(t).find("td:eq(1) > span").html(),topics:$(t).find("td:eq(2) > a").html(),date:$(t).find("td:eq(3) > span").html(),links:$(t).find("td:eq(4) > input").attr("name")})});var l={main_description:o,grad_description:n,course:i};a(l)},function(){o("can't access to course page")})})};"undefined"==typeof e.classData[d].detail?m(e.classData[d].url).then(function(t){e.classData[d].detail=t,localStorage.myClass=JSON.stringify(e.classData),e.$applyAsync(function(){e.state.loading=!1,e.state.isData=e.classData[d].detail}),e.$broadcast("scroll.refreshComplete")},f):(e.state.loading=!1,e.state.isData=e.classData[d].detail),e.isPageTopic===!1?(e.infoTab="active",e.topicsTab=""):(e.infoTab="",e.topicsTab="active"),e.switchTab=function(t){0===t&&(e.isPageTopic=!1,e.infoTab="active",e.topicsTab=""),1===t&&(e.isPageTopic=!0,e.infoTab="",e.topicsTab="active")};var f=function(t){u.alert({title:"Oops !",template:t}),e.$broadcast("scroll.refreshComplete")}}]),app.controller("ScheduleController",["$scope","$ionicPopup","$timeout","$ionicHistory","$rootScope","$ionicPlatform","BinusMaya","$q",function(e,t,a,o,n,i,l,r){if(n.noHeader=!1,n.leftMenu=!0,i.onHardwareBackButton(function(e){e.preventDefault()}),e.getState=function(e){var t=moment();return moment(e).isSame(t,"day")?"today":moment(e).isSame(t.add(1,"d"),"day")?"tomorrow":moment(e)<t?"completo":void 0},e.getCourseState=function(e,t){var a=moment(),o=null;try{var n=t.split("-")[1].split(":"),i=parseInt(n[0]),l=parseInt(n[1]);o=moment(e).hour(i).minute(l)}catch(r){o=moment(e)}return a>o?"completo":void 0},e.isSchedule=!1,e.schedule=[],localStorage.jadwal)try{JSON.parse(localStorage.jadwal).length>0&&(e.isSchedule=!0,e.schedule=JSON.parse(localStorage.jadwal))}catch(s){}var c=function(e){var t=[];return $(e).find("tr").each(function(e){var a=$(this).find("td");e>0&&t.push({date:a.eq(0).html(),time:a.eq(1).html(),state:a.eq(2).html(),course:a.eq(3).html().split("-")[1],code:a.eq(3).html().split("-")[0],myClass:a.eq(5).html(),room:a.eq(6).html(),building:a.eq(7).html()})}),t},u=function(){return r(function(e,t){l.checkLogin().then(function(){return l.api("/","get")},function(){t("can't re-auth your account")}).then(function(e){return l.frame($(e.result).find(".itemContent ul li:eq(0) > a").attr("href"))},function(){t("can't access to main frame")}).then(function(e){var t={},a=e.result;return $($(a.result).serializeArray()).each(function(e,a){t[a.name]=a.value}),t.__EVENTTARGET="ctl00$ContentPlaceHolder1$btnSchedule",l.api(_bimay_api_url+"/LMS/MyClass.aspx","post",t,!0)},function(){t("can't access frame")}).then(function(t){console.log(t);var a=$(t.result).find("table"),o=c(a.eq(0).html()),n=c(a.eq(1).html()),i=o.concat(n);localStorage.jadwal=JSON.stringify(l.grouping(i)),localStorage.lastUpdate=moment().format("D MMMM YYYY h:mm:ss"),e({jadwal:JSON.parse(localStorage.jadwal),lastUpdate:localStorage.lastUpdate})},function(){t("can't access schedule page")})})};e.doRefresh=function(){u().then(function(t){console.log(t),e.$broadcast("scroll.refreshComplete"),n.getLastUpdate(),t.jadwal.length>0?(e.isSchedule=!0,e.schedule=t.jadwal):a("No Schedule found")},a);var a=function(a){t.alert({title:"Oops !",template:a}),e.$broadcast("scroll.refreshComplete")}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImJpbnVzbWF5YS5qcyIsInJvdXRlLmpzIiwiY29udHJvbGxlcnMvbG9naW4uY29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL215Y2xhc3MuY29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL215Y2xhc3NJbnNpZGUuY29udHJvbGxlci5qcyIsImNvbnRyb2xsZXJzL3NjaGVkdWxlLmNvbnRyb2xsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBVUEsR0FBQSxXQUFBLFNBQ0EsT0FBQSxVQUNBLFdBQUEsK0JBQ0EsZUFBQSxvQ0FFQSxJQUFBLFFBQUEsT0FBQSxhQUFBLFFBQUEsWUFBQSxxQkFFQSxLQUFBLGlCQUFBLGFBQUEsZ0JBQUEsdUJBQUEsWUFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FFQSxFQUFBLE1BQUEsbUJBQUEsY0FBQSxTQUFBLEVBQUEsYUFBQSxRQUNBLEVBQUEsVUFBQSxFQUNBLEVBQUEsVUFBQSxtQkFBQSxjQUFBLE1BQUEsS0FBQSxhQUFBLE1BQUEsY0FDQSxFQUFBLGFBQUEsbUJBQUEsY0FBQSxjQUFBLEVBQUEsYUFBQSxtQkFDQSxjQUFBLGFBQ0EsY0FBQSxVQUVBLEVBQUEsTUFBQSxXQUNBLEVBQUEsYUFDQSxRQUFBLEdBSUEsT0FBQSxTQUFBLE9BQUEsUUFBQSxRQUFBLFVBQ0EsUUFBQSxRQUFBLFNBQUEsMEJBQUEsR0FFQSxPQUFBLFdBQ0EsVUFBQSxpQkFJQSxFQUFBLGNBQUEsV0FDQSxFQUFBLFdBQUEsbUJBQUEsY0FBQSxXQUFBLFdBQUEsYUFBQSxZQUVBLEVBQUEsZ0JBQ0EsRUFBQSxPQUFBLFdBQ0EsYUFBQSxRQUNBLE9BQUEsU0FBQSxLQUFBLEtBQ0EsRUFBQSxlQUNBLEVBQUEsZ0JBQUEsR0FDQSxTQUFBLFVBR0EsRUFBQSxnQkFBQSxXQUVBLEVBQUEsZ0JBQ0EsU0FBQSxHQUNBLGFBQUEsYUFBQSxFQUNBLEVBQUEsYUFBQSxHQUVBLGVBTUEsT0FBQSxTQUFBLEtBREEsRUFBQSxNQUNBLFlBRUEsT0FJQSxRQUFBLHVCQUFBLFNBQUEsR0FDQSxFQUFBLE1BQUEsY0FBQSxHQUNBLEVBQUEsTUFBQSxTQUFBLEtDekVBLFNBQUEsT0FBQSx1QkFFQSxRQUFBLGFBQUEsS0FBQSxTQUFBLEdBQ0EsT0FFQSxXQUFBLCtCQUNBLGVBQUEsb0NBRUEsUUFBQSxXQUNBLEdBQUEsR0FBQSxJQUNBLFFBQ0EsT0FBQSxhQUFBLE9BQUEsYUFBQSxPQUFBLEtBQ0EsT0FBQSxFQUFBLFdBQ0EsUUFBQSxFQUFBLGFBR0EsV0FBQSxXQUNBLEdBQUEsR0FBQSxLQUNBLEVBQUEsS0FBQSxNQUFBLGFBQUEsUUFDQSxPQUFBLEdBQUEsU0FBQSxFQUFBLEdBQ0EsTUFBQSxjQUFBLGFBQUEsRUFHQSxFQUFBLElBQUEsSUFBQSxPQUNBLEtBQUEsU0FBQSxHQUNBLE1BQUEsRUFBQSxNQUFBLEVBQUEsRUFDQSxJQUFBLEtBT0EsT0FOQSxHQUFBLEVBQUEsRUFBQSxRQUFBLGtCQUFBLEtBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxFQUFBLE1BQUEsRUFBQSxRQUVBLEVBQUEsVUFBQSxFQUFBLFFBQ0EsRUFBQSxZQUFBLEVBQUEsU0FDQSxFQUFBLFNBQUEsVUFDQSxFQUFBLElBQUEsSUFBQSxPQUFBLElBQ0EsR0FDQSxLQUFBLFdBQ0EsYUFBQSxXQUFBLEVBQ0EsR0FBQSxJQUNBLElBakJBLEdBQUEsR0FBQSxXQXFCQSxJQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxHQUFBLEdBQUEsSUFFQSxPQUFBLFVBQUEsYUFBQSxPQUNBLEVBQUEsYUFDQSxLQUFBLFdBQ0EsTUFBQSxHQUFBLElBQUEsRUFBQSxFQUFBLEtBR0EsRUFBQSxTQUFBLEVBQUEsR0FDQSxRQUFBLEVBQ0EsV0FBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLFdBQUEsRUFBQSxFQUFBLEdBQ0EsUUFBQSxFQUFBLFlBR0EsV0FBQSxLQUFBLEVBQUEsRUFBQSxFQUFBLFdBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxRQUFBLEVBQUEsZUFPQSxNQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsS0FDQSxFQUFBLEVBQ0EsT0FBQSxHQUFBLFNBQUEsRUFBQSxHQUNBLE1BQUEsR0FBQSxJQUFBLEVBQUEsT0FDQSxLQUFBLFNBQUEsR0FDQSxNQUFBLEdBQUEsSUFBQSxFQUFBLEVBQUEsUUFBQSxLQUFBLHFCQUFBLEtBQUEsT0FBQSxRQUNBLEdBQ0EsS0FBQSxTQUFBLEdBRUEsTUFEQSxHQUFBLEVBQUEsRUFBQSxRQUFBLEtBQUEsV0FBQSxLQUFBLE9BQ0EsRUFBQSxJQUFBLEVBQUEsVUFBQSxJQUNBLEdBQ0EsS0FBQSxTQUFBLEdBQ0EsR0FDQSxJQUFBLEVBQ0EsT0FBQSxLQUVBLE1BSUEsV0FBQSxXQUNBLEdBQUEsR0FBQSxJQUNBLE9BQUEsR0FBQSxTQUFBLEVBQUEsR0FDQSxXQUFBLElBQUEsRUFBQSxXQUFBLFNBQUEsR0FDQSxLQUFBLEVBQUEsTUFDQSxhQUFBLE9BQUEsRUFBQSxPQUFBLGNBQ0EsR0FBQSxJQUVBLEVBQUEsSUFFQSxNQUdBLGNBQUEsYUFHQSxTQUFBLFNBQUEsR0FDQSxHQUFBLEVBQUEsUUFBQSxFQUNBLFFBRUEsSUFBQSxNQUNBLEVBQUEsR0FDQSxFQUFBLEdBQ0EsRUFBQSxDQVVBLE9BVEEsR0FBQSxRQUFBLFNBQUEsR0FDQSxHQUFBLEVBQUEsTUFDQSxFQUFBLEdBQUEsS0FBQSxHQUFBLEVBQUEsTUFFQSxFQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsS0FDQSxFQUFBLElBQUEsS0FBQSxFQUFBLEtBQUEsU0FDQSxFQUFBLEdBQUEsS0FBQSxHQUFBLEtBR0EsT0N2SEEsUUFBQSxPQUFBLGdCQUVBLFFBQUEsaUJBQUEscUJBQUEsU0FBQSxFQUFBLEdBQ0EsRUFDQSxNQUFBLFNBQ0EsSUFBQSxJQUNBLE9BQ0EsYUFDQSxZQUFBLFVBQUEsaUJBSUEsTUFBQSxZQUNBLElBQUEsWUFDQSxPQUNBLGFBQ0EsWUFBQSxVQUFBLGdCQUNBLFdBQUEseUJBSUEsTUFBQSxTQUNBLElBQUEsU0FDQSxPQUNBLGFBQ0EsWUFBQSxVQUFBLGlCQUlBLE1BQUEsU0FDQSxJQUFBLFNBQ0EsT0FDQSxhQUNBLFlBQUEsVUFBQSxhQUNBLFdBQUEsc0JBSUEsTUFBQSxZQUNBLElBQUEsWUFDQSxPQUNBLGFBQ0EsWUFBQSxVQUFBLHNCQUNBLFdBQUEseUJBSUEsTUFBQSxXQUNBLElBQUEsV0FDQSxPQUNBLGFBQ0EsWUFBQSxVQUFBLGVBQ0EsV0FBQSx3QkFJQSxNQUFBLGlCQUNBLElBQUEsd0JBQ0EsU0FDQSxTQUFBLEtBQUEsZUFBQSxZQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsR0FBQSxJQUFBLEVBQ0EsRUFBQSxFQUFBLFFBQ0EsRUFBQSxtQkFBQSxjQUFBLFFBQUEsS0FBQSxNQUFBLGFBQUEsVUFBQSxDQUNBLEtBQUEsR0FBQSxLQUFBLEdBQ0EsRUFBQSxHQUFBLE1BQUEsRUFBQSxPQUNBLEVBQUEsRUFRQSxPQUxBLEdBQ0EsRUFBQSxRQUFBLEdBRUEsRUFBQSxLQUFBLFlBQUEsVUFFQSxFQUFBLFdBR0EsT0FDQSxhQUNBLFlBQUEsVUFBQSxxQkFDQSxXQUFBLDhCQUlBLE1BQUEsZ0JBQ0EsSUFBQSxpQkFDQSxPQUNBLGFBQ0EsWUFBQSxVQUFBLDhCQUNBLFdBQUEsNkJBSUEsTUFBQSxhQUNBLElBQUEsY0FDQSxPQUNBLGFBQ0EsWUFBQSxVQUFBLDJCQUNBLFdBQUEsMEJBSUEsTUFBQSxpQkFDQSxJQUFBLGtCQUNBLE9BQ0EsYUFDQSxZQUFBLFVBQUEsd0JBQ0EsV0FBQSx3QkFJQSxNQUFBLFdBQ0EsSUFBQSxXQUNBLE9BQ0EsYUFDQSxZQUFBLFVBQUEsd0JBQ0EsV0FBQSx3QkFJQSxNQUFBLFVBQ0EsSUFBQSxVQUNBLE9BQ0EsYUFDQSxZQUFBLFVBQUEsa0JBS0EsRUFBQSxVQUFBLGNDaElBLElBQUEsV0FBQSxtQkFDQSxTQUFBLGNBQUEsV0FBQSxnQkFBQSx1QkFBQSxhQUFBLFlBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUVBLEVBQUEsVUFBQSxFQUNBLEVBQUEsU0FBQSxHQUVBLEVBQUEsU0FBQSxFQUNBLEVBQUEsV0FBQSxHQUVBLEVBQUEsaUJBQ0EsYUFBQSxJQUdBLEVBQUEsT0FBQSxXQUNBLEdBQUEsRUFBQSxTQUFBLEVBQUEsU0FLQSxDQUNBLEVBQUEsV0FBQSxhQUNBLEVBQUEsU0FBQSxFQUNBLEVBQUEsSUFBQSxJQUFBLE9BQ0EsS0FBQSxTQUFBLEdBQ0EsTUFBQSxFQUFBLE1BQUEsRUFBQSxFQUNBLElBQUEsS0FPQSxPQU5BLEdBQUEsRUFBQSxFQUFBLFFBQUEsa0JBQUEsS0FBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLEVBQUEsTUFBQSxFQUFBLFFBRUEsRUFBQSxVQUFBLEVBQUEsUUFDQSxFQUFBLFlBQUEsRUFBQSxTQUNBLEVBQUEsU0FBQSxVQUNBLEVBQUEsSUFBQSxJQUFBLE9BQUEsSUFDQSxHQUNBLEtBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLEVBQUEsUUFBQSxLQUFBLGlDQUVBLE9BQUEsRUFBQSxNQUNBLEVBQUEsR0FDQSxFQUFBLFFBQUEsRUFDQSxFQUFBLEVBQUEsRUFBQSxFQUFBLFFBQUEsS0FBQSxhQUFBLFNBRUEsRUFBQSxTQUFBLEVBQ0EsRUFBQSxXQUFBLEdBTUEsYUFBQSxRQUFBLEtBQUEsV0FDQSxRQUFBLEVBQUEsUUFDQSxTQUFBLEVBQUEsV0FHQSxhQUFBLFNBQUEsRUFDQSxhQUFBLE1BQUEsRUFBQSxPQUNBLEVBQUEsT0FBQSxFQUNBLEVBQUEsVUFBQSxhQUFBLE1BQUEsY0FDQSxFQUFBLFdBQUEsR0FDQSxFQUFBLFNBQUEsRUFDQSxPQUFBLFNBQUEsS0FBQSxhQUNBLEVBQUEsZUFDQSxFQUFBLGdCQUFBLEtBR0EsRUFFQSxJQUFBLEdBQUEsU0FBQSxFQUFBLEdBRUEsRUFBQSxTQUFBLEVBQ0EsRUFBQSxXQUFBLEdBQ0EsRUFBQSxPQUNBLE1BQUEsU0FDQSxTQUFBLEVBQUEsRUFBQSwyQkExREEsR0FBQSxPQUNBLE1BQUEsU0FDQSxTQUFBLDhDQ2JBLElBQUEsV0FBQSxxQkFDQSxTQUFBLFlBQUEsdUJBQUEsU0FBQSxZQUFBLGVBQUEsV0FBQSxhQUFBLGlCQUFBLEtBQUEsY0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFVBQUEsRUFDQSxFQUFBLFVBQUEsRUFDQSxFQUFBLHFCQUFBLFNBQUEsR0FDQSxFQUFBLG1CQUdBLEVBQUEsVUFBQSxtQkFBQSxjQUFBLFFBQUEsS0FBQSxNQUFBLGFBQUEsVUFBQSxDQUVBLElBQUEsR0FBQSxXQUNBLE1BQUEsR0FBQSxTQUFBLEVBQUEsR0FDQSxFQUFBLGFBQ0EsS0FBQSxXQUNBLE1BQUEsR0FBQSxJQUFBLElBQUEsUUFDQSxXQUVBLEVBQUEsZ0NBR0EsS0FBQSxTQUFBLEdBQ0EsTUFBQSxHQUFBLE1BQ0EsRUFBQSxFQUFBLFFBQUEsS0FBQSxnQ0FBQSxLQUFBLFVBRUEsV0FDQSxFQUFBLGdDQUVBLEtBQUEsU0FBQSxHQUNBLEdBQUEsS0FHQSxHQUFBLEVBQUEsT0FBQSxRQUFBLEtBQUEsNkNBQUEsS0FBQSxTQUFBLEVBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxHQUFBLEtBQUEsS0FBQSxPQUNBLEVBQUEsRUFBQSxNQUFBLHVCQUNBLEdBQUEsTUFDQSxVQUFBLEVBQ0EsS0FBQSxFQUFBLEdBQ0EsSUFBQSxFQUFBLEdBQUEsS0FBQSxLQUFBLEtBQUEsUUFDQSxLQUFBLEVBQUEsR0FDQSxVQUFBLEVBQUEsT0FHQSxhQUFBLFFBQUEsS0FBQSxVQUFBLEdBQ0EsRUFBQSxJQUNBLFdBQ0EsRUFBQSxnQ0FLQSxHQUFBLFVBQUEsV0FDQSxJQUNBLEtBQUEsU0FBQSxHQUNBLEVBQUEsT0FBQSxFQUNBLEVBQUEsVUFBQSxFQUVBLEVBQUEsNEJBRUEsRUFBQSxXQUFBLDJCQUNBLEVBRUEsSUFBQSxHQUFBLFNBQUEsR0FDQSxFQUFBLE9BQ0EsTUFBQSxTQUNBLFNBQUEsSUFFQSxFQUFBLFdBQUEsK0JDbEVBLElBQUEsV0FBQSwyQkFDQSxTQUFBLFlBQUEsdUJBQUEsU0FBQSxZQUFBLGVBQUEsV0FBQSxhQUFBLGlCQUFBLEtBQUEsY0FBQSxVQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUNBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBRUEsRUFBQSxVQUFBLG1CQUFBLGNBQUEsUUFBQSxLQUFBLE1BQUEsYUFBQSxVQUFBLEVBQ0EsRUFBQSxPQUNBLFFBQUEsRUFDQSxTQUFBLEdBRUEsRUFBQSxLQUFBLEVBQUEsVUFBQSxHQUNBLEVBQUEsUUFBQSxTQUNBLEVBQUEsVUFBQSxFQUVBLElBQUEsR0FBQSxTQUFBLEdBQ0EsTUFBQSxHQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsYUFDQSxLQUFBLFdBQ0EsTUFBQSxHQUFBLElBQUEsSUFBQSxRQUNBLFdBRUEsRUFBQSxnQ0FHQSxLQUFBLFNBQUEsR0FDQSxNQUFBLEdBQUEsTUFDQSxFQUFBLEVBQUEsUUFBQSxLQUFBLGdDQUFBLEtBQUEsVUFFQSxXQUNBLEVBQUEsZ0NBRUEsS0FBQSxXQUVBLE1BREEsU0FBQSxNQUNBLEVBQUEsSUFBQSxlQUFBLFFBQUEsRUFBQSxVQUFBLElBQ0EsV0FDQSxFQUFBLDhCQUVBLEtBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLE9BQ0EsRUFBQSxFQUFBLEdBQUEsS0FBQSw0QkFBQSxPQUNBLEVBQUEsRUFBQSxHQUFBLEtBQUEsNkJBQUEsT0FDQSxJQUVBLEdBQUEsR0FBQSxLQUFBLDhEQUFBLEtBQUEsU0FBQSxFQUFBLEdBQ0EsSUFBQSxHQUNBLEVBQUEsTUFDQSxRQUFBLFNBQUEsRUFBQSxHQUFBLEtBQUEsbUJBQUEsUUFDQSxLQUFBLEVBQUEsR0FBQSxLQUFBLG1CQUFBLE9BQ0EsT0FBQSxFQUFBLEdBQUEsS0FBQSxnQkFBQSxPQUNBLEtBQUEsRUFBQSxHQUFBLEtBQUEsbUJBQUEsT0FDQSxNQUFBLEVBQUEsR0FBQSxLQUFBLG9CQUFBLEtBQUEsV0FLQSxJQUFBLElBQ0EsaUJBQUEsRUFDQSxpQkFBQSxFQUNBLE9BQUEsRUFFQSxHQUFBLElBQ0EsV0FDQSxFQUFBLG1DQUtBLG9CQUFBLEdBQUEsVUFBQSxHQUFBLE9BQ0EsRUFBQSxFQUFBLFVBQUEsR0FBQSxLQUNBLEtBQUEsU0FBQSxHQUNBLEVBQUEsVUFBQSxHQUFBLE9BQUEsRUFDQSxhQUFBLFFBQUEsS0FBQSxVQUFBLEVBQUEsV0FDQSxFQUFBLFlBQUEsV0FDQSxFQUFBLE1BQUEsU0FBQSxFQUNBLEVBQUEsTUFBQSxPQUFBLEVBQUEsVUFBQSxHQUFBLFNBRUEsRUFBQSxXQUFBLDJCQUNBLElBRUEsRUFBQSxNQUFBLFNBQUEsRUFDQSxFQUFBLE1BQUEsT0FBQSxFQUFBLFVBQUEsR0FBQSxRQUdBLEVBQUEsZUFBQSxHQUNBLEVBQUEsUUFBQSxTQUNBLEVBQUEsVUFBQSxLQUVBLEVBQUEsUUFBQSxHQUNBLEVBQUEsVUFBQSxVQUdBLEVBQUEsVUFBQSxTQUFBLEdBQ0EsSUFBQSxJQUNBLEVBQUEsYUFBQSxFQUNBLEVBQUEsUUFBQSxTQUNBLEVBQUEsVUFBQSxJQUVBLElBQUEsSUFDQSxFQUFBLGFBQUEsRUFDQSxFQUFBLFFBQUEsR0FDQSxFQUFBLFVBQUEsVUFJQSxJQUFBLEdBQUEsU0FBQSxHQUNBLEVBQUEsT0FDQSxNQUFBLFNBQ0EsU0FBQSxJQUVBLEVBQUEsV0FBQSw4QkM1R0EsSUFBQSxXQUFBLHNCQUNBLFNBQUEsY0FBQSxXQUFBLGdCQUFBLGFBQUEsaUJBQUEsWUFBQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQTZDQSxHQTNDQSxFQUFBLFVBQUEsRUFDQSxFQUFBLFVBQUEsRUFDQSxFQUFBLHFCQUFBLFNBQUEsR0FDQSxFQUFBLG1CQUdBLEVBQUEsU0FBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLFFBRUEsT0FBQSxRQUFBLEdBQUEsT0FBQSxFQUFBLE9BQ0EsUUFHQSxPQUFBLEdBQUEsT0FBQSxFQUFBLElBQUEsRUFBQSxLQUFBLE9BQ0EsV0FHQSxPQUFBLEdBQUEsRUFDQSxXQURBLFFBS0EsRUFBQSxlQUFBLFNBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxTQUNBLEVBQUEsSUFDQSxLQUNBLEdBQUEsR0FBQSxFQUFBLE1BQUEsS0FBQSxHQUFBLE1BQUEsS0FDQSxFQUFBLFNBQUEsRUFBQSxJQUNBLEVBQUEsU0FBQSxFQUFBLEdBRUEsR0FBQSxPQUFBLEdBQUEsS0FBQSxHQUFBLE9BQUEsR0FDQSxNQUFBLEdBQ0EsRUFBQSxPQUFBLEdBR0EsTUFBQSxHQUFBLEVBQ0EsV0FEQSxRQUtBLEVBQUEsWUFBQSxFQUNBLEVBQUEsWUFFQSxhQUFBLE9BQ0EsSUFDQSxLQUFBLE1BQUEsYUFBQSxRQUFBLE9BQUEsSUFDQSxFQUFBLFlBQUEsRUFDQSxFQUFBLFNBQUEsS0FBQSxNQUFBLGFBQUEsU0FFQSxNQUFBLElBS0EsR0FBQSxHQUFBLFNBQUEsR0FDQSxHQUFBLEtBZ0JBLE9BZkEsR0FBQSxHQUFBLEtBQUEsTUFBQSxLQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxNQUFBLEtBQUEsS0FDQSxHQUFBLEdBQ0EsRUFBQSxNQUNBLEtBQUEsRUFBQSxHQUFBLEdBQUEsT0FDQSxLQUFBLEVBQUEsR0FBQSxHQUFBLE9BQ0EsTUFBQSxFQUFBLEdBQUEsR0FBQSxPQUNBLE9BQUEsRUFBQSxHQUFBLEdBQUEsT0FBQSxNQUFBLEtBQUEsR0FDQSxLQUFBLEVBQUEsR0FBQSxHQUFBLE9BQUEsTUFBQSxLQUFBLEdBQ0EsUUFBQSxFQUFBLEdBQUEsR0FBQSxPQUNBLEtBQUEsRUFBQSxHQUFBLEdBQUEsT0FDQSxTQUFBLEVBQUEsR0FBQSxHQUFBLFdBSUEsR0FHQSxFQUFBLFdBQ0EsTUFBQSxHQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsYUFDQSxLQUFBLFdBQ0EsTUFBQSxHQUFBLElBQUEsSUFBQSxRQUNBLFdBRUEsRUFBQSxnQ0FHQSxLQUFBLFNBQUEsR0FDQSxNQUFBLEdBQUEsTUFDQSxFQUFBLEVBQUEsUUFBQSxLQUFBLGdDQUFBLEtBQUEsVUFFQSxXQUNBLEVBQUEsZ0NBRUEsS0FBQSxTQUFBLEdBQ0EsR0FBQSxNQUNBLEVBQUEsRUFBQSxNQUtBLE9BSkEsR0FBQSxFQUFBLEVBQUEsUUFBQSxrQkFBQSxLQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsRUFBQSxNQUFBLEVBQUEsUUFFQSxFQUFBLGNBQUEsd0NBQ0EsRUFBQSxJQUFBLGVBQUEsb0JBQUEsT0FBQSxHQUFBLElBQ0EsV0FDQSxFQUFBLHdCQUVBLEtBQUEsU0FBQSxHQUNBLFFBQUEsSUFBQSxFQUNBLElBQUEsR0FBQSxFQUFBLEVBQUEsUUFBQSxLQUFBLFNBQ0EsRUFBQSxFQUFBLEVBQUEsR0FBQSxHQUFBLFFBQ0EsRUFBQSxFQUFBLEVBQUEsR0FBQSxHQUFBLFFBQ0EsRUFBQSxFQUFBLE9BQUEsRUFDQSxjQUFBLE9BQUEsS0FBQSxVQUFBLEVBQUEsU0FBQSxJQUNBLGFBQUEsV0FBQSxTQUFBLE9BQUEsdUJBQ0EsR0FBQSxPQUFBLEtBQUEsTUFBQSxhQUFBLFFBQUEsV0FBQSxhQUFBLGNBQ0EsV0FDQSxFQUFBLGtDQUtBLEdBQUEsVUFBQSxXQUNBLElBQ0EsS0FBQSxTQUFBLEdBQ0EsUUFBQSxJQUFBLEdBQ0EsRUFBQSxXQUFBLDBCQUNBLEVBQUEsZ0JBQ0EsRUFBQSxPQUFBLE9BQUEsR0FDQSxFQUFBLFlBQUEsRUFDQSxFQUFBLFNBQUEsRUFBQSxRQUVBLEVBQUEsc0JBRUEsRUFFQSxJQUFBLEdBQUEsU0FBQSxHQUNBLEVBQUEsT0FDQSxNQUFBLFNBQ0EsU0FBQSxJQUVBLEVBQUEsV0FBQSIsImZpbGUiOiJ3d3cvanMvY29tcGlsZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEJJTlVTTUFZQSBNT0RVTEVcbiAqIEBhdXRob3IgUGVkb3ggPG5hdWZhbEBtYXJ0YWJha2FuZy51cz5cbiAqL1xuXG5cbi8vIGFuZ3VsYXIubW9kdWxlIGlzIGEgZ2xvYmFsIHBsYWNlIGZvciBjcmVhdGluZywgcmVnaXN0ZXJpbmcgYW5kIHJldHJpZXZpbmcgQW5ndWxhciBtb2R1bGVzXG4vLyAnc3RhcnRlcicgaXMgdGhlIG5hbWUgb2YgdGhpcyBhbmd1bGFyIG1vZHVsZSBleGFtcGxlIChhbHNvIHNldCBpbiBhIDxib2R5PiBhdHRyaWJ1dGUgaW4gaW5kZXguaHRtbClcbi8vIHRoZSAybmQgcGFyYW1ldGVyIGlzIGFuIGFycmF5IG9mICdyZXF1aXJlcydcblxudmFyIHZpZXdfcGF0aCA9ICd2aWV3cy8nLFxuICBwY29sb3IgPSAnIzFDNTM2RicsXG4gIF9iaW1heV91cmwgPSAnaHR0cDovL2JpbnVzbWF5YS5iaW51cy5hYy5pZCcsXG4gIF9iaW1heV9hcGlfdXJsID0gJ2h0dHA6Ly9hcHBzLmJpbnVzbWF5YS5iaW51cy5hYy5pZCc7XG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnQmludXNNYXlhJywgWydpb25pYycsICdsaXN0Um91dGUnLCAnQmludXNNYXlhRmFjdG9yeSddKVxuXG4ucnVuKGZ1bmN0aW9uKCRpb25pY1BsYXRmb3JtLCAkcm9vdFNjb3BlLCAkaW9uaWNIaXN0b3J5LCAkaW9uaWNOYXZCYXJEZWxlZ2F0ZSwgQmludXNNYXlhKSB7XG5cbiAgJHJvb3RTY29wZS5sb2dpbiA9ICh0eXBlb2YgbG9jYWxTdG9yYWdlLmlzbG9naW4gPT0gXCJ1bmRlZmluZWRcIiA/IGZhbHNlIDogbG9jYWxTdG9yYWdlLmlzbG9naW4pO1xuICAkcm9vdFNjb3BlLmxlZnRNZW51ID0gZmFsc2U7XG4gICRyb290U2NvcGUubG9naW5OYW1lID0gdHlwZW9mIGxvY2FsU3RvcmFnZS5mbmFtZSA9PSBcInVuZGVmaW5lZFwiID8gbnVsbCA6IGxvY2FsU3RvcmFnZS5mbmFtZS50b0xvd2VyQ2FzZSgpO1xuICAkcm9vdFNjb3BlLnByb2ZpbGVJbWFnZSA9IHR5cGVvZiBsb2NhbFN0b3JhZ2UucHJvZmlsZUltYWdlID09IFwidW5kZWZpbmVkXCIgPyBmYWxzZSA6IGxvY2FsU3RvcmFnZS5wcm9maWxlSW1hZ2U7XG4gIGRlbGV0ZSBsb2NhbFN0b3JhZ2UuY29va2llO1xuICBkZWxldGUgbG9jYWxTdG9yYWdlLnRlbXBsb2dpbjtcblxuICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAkcm9vdFNjb3BlLm9uTG9hZFN0eWxlID0ge1xuICAgICAgb3BhY2l0eTogMVxuICAgIH07XG4gICAgLy8gSGlkZSB0aGUgYWNjZXNzb3J5IGJhciBieSBkZWZhdWx0IChyZW1vdmUgdGhpcyB0byBzaG93IHRoZSBhY2Nlc3NvcnkgYmFyIGFib3ZlIHRoZSBrZXlib2FyZFxuICAgIC8vIGZvciBmb3JtIGlucHV0cylcbiAgICBpZiAod2luZG93LmNvcmRvdmEgJiYgd2luZG93LmNvcmRvdmEucGx1Z2lucy5LZXlib2FyZCkge1xuICAgICAgY29yZG92YS5wbHVnaW5zLktleWJvYXJkLmhpZGVLZXlib2FyZEFjY2Vzc29yeUJhcih0cnVlKTtcbiAgICB9XG4gICAgaWYgKHdpbmRvdy5TdGF0dXNCYXIpIHtcbiAgICAgIFN0YXR1c0Jhci5zdHlsZURlZmF1bHQoKTtcbiAgICB9XG4gIH0pO1xuXG4gICRyb290U2NvcGUuZ2V0TGFzdFVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICRyb290U2NvcGUubGFzdFVwZGF0ZSA9IHR5cGVvZiBsb2NhbFN0b3JhZ2UubGFzdFVwZGF0ZSA9PT0gXCJ1bmRlZmluZWRcIiA/IFwiV2hhdGV2ZXJcIiA6IGxvY2FsU3RvcmFnZS5sYXN0VXBkYXRlO1xuICB9O1xuICAkcm9vdFNjb3BlLmdldExhc3RVcGRhdGUoKTtcbiAgJHJvb3RTY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICBsb2NhbFN0b3JhZ2UuY2xlYXIoKTtcbiAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9ICcjLyc7XG4gICAgJGlvbmljSGlzdG9yeS5jbGVhckhpc3RvcnkoKTtcbiAgICAkaW9uaWNOYXZCYXJEZWxlZ2F0ZS5zaG93QmFja0J1dHRvbihmYWxzZSk7XG4gICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gIH07XG5cbiAgJHJvb3RTY29wZS5nZXRQcm9maWxlSW1hZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAvKiogcGVmb3JtIGF2YXRhciAqKi9cbiAgICBCaW51c01heWEuZ2V0UHJvZmlsZUltYWdlKFxuICAgICAgZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICBsb2NhbFN0b3JhZ2UucHJvZmlsZUltYWdlID0gZG9uZTtcbiAgICAgICAgJHJvb3RTY29wZS5wcm9maWxlSW1hZ2UgPSBkb25lO1xuICAgICAgfSxcbiAgICAgIGZ1bmN0aW9uKCkge1xuXG4gICAgICB9KTtcbiAgfTtcblxuICBpZiAoJHJvb3RTY29wZS5sb2dpbikge1xuICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gJy9zY2hlZHVsZSc7XG4gIH0gZWxzZSB7XG4gICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAnLyc7XG4gIH1cbn0pXG5cbi5jb25maWcoZnVuY3Rpb24oJGlvbmljQ29uZmlnUHJvdmlkZXIpIHtcbiAgJGlvbmljQ29uZmlnUHJvdmlkZXIudmlld3MuZm9yd2FyZENhY2hlKGZhbHNlKTtcbiAgJGlvbmljQ29uZmlnUHJvdmlkZXIudmlld3MubWF4Q2FjaGUoMCk7XG59KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdCaW51c01heWFGYWN0b3J5JywgW10pXG5cbi5mYWN0b3J5KCdCaW51c01heWEnLCBmdW5jdGlvbigkcSkge1xuICByZXR1cm4ge1xuXG4gICAgX2JpbWF5X3VybDogJ2h0dHA6Ly9iaW51c21heWEuYmludXMuYWMuaWQnLFxuICAgIF9iaW1heV9hcGlfdXJsOiAnaHR0cDovL2FwcHMuYmludXNtYXlhLmJpbnVzLmFjLmlkJyxcblxuICAgIGhlYWRlcnM6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIF90ID0gdGhpcztcbiAgICAgIHJldHVybiAge1xuICAgICAgICBDb29raWU6IGxvY2FsU3RvcmFnZS5jb29raWUgPyBsb2NhbFN0b3JhZ2UuY29va2llIDogbnVsbCxcbiAgICAgICAgT3JpZ2luOiBfdC5fYmltYXlfdXJsLFxuICAgICAgICBSZWZlcmVyOiBfdC5fYmltYXlfdXJsXG4gICAgICB9O1xuICAgIH0sXG4gICAgY2hlY2tMb2dpbjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgX3QgPSB0aGlzO1xuICAgICAgdmFyIGxvZ2luID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UubG9naW5JZCk7XG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGlmKGxvY2FsU3RvcmFnZS50ZW1wbG9naW4gPT09IHRydWUpIHtcbiAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBfdC5hcGkoJy8nLCAnZ2V0JylcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICBpZihkLmNvZGUgIT09IDIwMCkgcmVqZWN0KGQpO1xuICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcbiAgICAgICAgICAgICQoJChkLnJlc3VsdCkuc2VyaWFsaXplQXJyYXkoKSkuZWFjaChmdW5jdGlvbihpLCBkKSB7XG4gICAgICAgICAgICAgIGRhdGFbZC5uYW1lXSA9IGQudmFsdWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRhdGEudHh0VXNlcklkID0gbG9naW4uYmludXNpZDtcbiAgICAgICAgICAgIGRhdGEudHh0UGFzc3dvcmQgPSBsb2dpbi5wYXNzd29yZDtcbiAgICAgICAgICAgIGRhdGEuYnRuTG9naW4gPSBcIkxvZyBJbiBcIjtcbiAgICAgICAgICAgIHJldHVybiBfdC5hcGkoJy8nLCAncG9zdCcsIGRhdGEpO1xuICAgICAgICAgIH0sIHJlamVjdClcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UudGVtcGxvZ2luID0gdHJ1ZTtcbiAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBhcGk6IGZ1bmN0aW9uKGVuZHBvaW50LCBtZXRob2QsIHBhcmFtcywgbm9FbmRwb2ludCkge1xuICAgICAgdmFyIF90ID0gdGhpcztcbiAgICAgIHR5cGVvZiBub0VuZHBvaW50ICE9PSBcInVuZGVmaW5lZFwiID8gZmFsc2UgOiB0cnVlO1xuICAgICAgaWYgKGxvY2FsU3RvcmFnZS5jb29raWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gX3QuX2dldENvb2tpZSgpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBfdC5hcGkoZW5kcG9pbnQsIG1ldGhvZCwgcGFyYW1zKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgaWYgKG1ldGhvZCA9PT0gXCJnZXRcIikge1xuICAgICAgICAgICAgaHR0cGNsaWVudC5nZXQoKG5vRW5kcG9pbnQgPyBlbmRwb2ludCA6IF90Ll9iaW1heV91cmwgKyBlbmRwb2ludCksIHJlc29sdmUsIHJlamVjdCwge1xuICAgICAgICAgICAgICBoZWFkZXJzOiBfdC5oZWFkZXJzKClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBodHRwY2xpZW50LnBvc3QoKG5vRW5kcG9pbnQgPyBlbmRwb2ludCA6IF90Ll9iaW1heV91cmwgKyBlbmRwb2ludCksIHBhcmFtcywgcmVzb2x2ZSwgcmVqZWN0LCB7XG4gICAgICAgICAgICAgIGhlYWRlcnM6IF90LmhlYWRlcnMoKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgZnJhbWU6IGZ1bmN0aW9uKHVybCkge1xuICAgICAgdmFyIF90ID0gdGhpcyxcbiAgICAgICAgIF91cmwgPSAnJztcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgcmV0dXJuIF90LmFwaSh1cmwsICdnZXQnKVxuICAgICAgICAudGhlbihmdW5jdGlvbihkKSB7XG4gICAgICAgICAgcmV0dXJuIF90LmFwaSgkKGQucmVzdWx0KS5maW5kKFwiI2N0bDAwX2NwMV9pZnJBcHBcIikuYXR0cihcInNyY1wiKSwgJ2dldCcpO1xuICAgICAgICB9LCByZWplY3QpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICBfdXJsID0gJChkLnJlc3VsdCkuZmluZChcIiNpZnJBcHBcIikuYXR0cihcInNyY1wiKTtcbiAgICAgICAgICByZXR1cm4gX3QuYXBpKF91cmwsICdnZXQnLCB7fSwgdHJ1ZSk7XG4gICAgICAgIH0sIHJlamVjdClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oZCkge1xuICAgICAgICAgIHJlc29sdmUoe1xuICAgICAgICAgICAgdXJsOiBfdXJsLFxuICAgICAgICAgICAgcmVzdWx0OiBkXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sIHJlamVjdCk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgX2dldENvb2tpZTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgX3QgPSB0aGlzO1xuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBodHRwY2xpZW50LmdldChfdC5fYmltYXlfdXJsLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgaWYgKGRhdGEuY29kZSA9PSAyMDApIHtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5jb29raWUgPSBkYXRhLmhlYWRlclsnU2V0LUNvb2tpZSddO1xuICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVqZWN0KGRhdGEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgcmVzb2x2ZSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIF9yZXF1ZXN0RXJyb3I6IGZ1bmN0aW9uKGRhdGEpIHtcblxuICAgIH0sXG4gICAgZ3JvdXBpbmc6IGZ1bmN0aW9uKF9kYXRhKSB7XG5cdFx0XHRpZihfZGF0YS5sZW5ndGggPD0gMCkge1xuXHRcdFx0XHRyZXR1cm4gW107XG5cdFx0XHR9XG5cdFx0XHR2YXIgbSA9IFtdLFxuXHRcdFx0XHRwID0gJycsXG5cdFx0XHRcdGMgPSAtMSxcblx0XHRcdFx0Y2ggPSAwO1xuXHRcdFx0X2RhdGEuZm9yRWFjaChmdW5jdGlvbihkLGkpIHtcblx0XHRcdFx0aWYocCA9PSBkLmRhdGUpIHtcblx0XHRcdFx0XHRtW2NdLmRhdGFbY2hdID0gZDsgY2grKztcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjaCA9IDE7IGMrKzsgcCA9IGQuZGF0ZTtcblx0XHRcdFx0XHRtW2NdID0ge2RhdGU6IGQuZGF0ZSwgZGF0YTogW119O1xuXHRcdFx0XHRcdG1bY10uZGF0YVswXSA9IGQ7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIG07XG5cdFx0fVxuICB9O1xufSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnbGlzdFJvdXRlJywgW10pXG5cbi5jb25maWcoWyckc3RhdGVQcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG4gICRzdGF0ZVByb3ZpZGVyXG4gICAgLnN0YXRlKCdpbmRleCcsIHtcbiAgICAgIHVybDogJy8nLFxuICAgICAgdmlld3M6IHtcbiAgICAgICAgJ21haW4tdmlldyc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogdmlld19wYXRoICsgJ2xvZ2luLmh0bWwnXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgnc2NoZWR1bGUnLCB7XG4gICAgICB1cmw6ICcvc2NoZWR1bGUnLFxuICAgICAgdmlld3M6IHtcbiAgICAgICAgJ21haW4tdmlldyc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogdmlld19wYXRoICsgJ3NjaGVkdWxlLmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdTY2hlZHVsZUNvbnRyb2xsZXInXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgnYWJvdXQnLCB7XG4gICAgICB1cmw6ICcvYWJvdXQnLFxuICAgICAgdmlld3M6IHtcbiAgICAgICAgJ21haW4tdmlldyc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogdmlld19wYXRoICsgJ2Fib3V0Lmh0bWwnXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgnZm9ydW0nLCB7XG4gICAgICB1cmw6ICcvZm9ydW0nLFxuICAgICAgdmlld3M6IHtcbiAgICAgICAgJ21haW4tdmlldyc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogdmlld19wYXRoICsgJ2ZvcnVtLmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdGb3J1bUNvbnRyb2xsZXInXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgnc2VydmljZXMnLCB7XG4gICAgICB1cmw6ICcvc2VydmljZXMnLFxuICAgICAgdmlld3M6IHtcbiAgICAgICAgJ21haW4tdmlldyc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogdmlld19wYXRoICsgJ3NlcnZpY2VzL2luZGV4Lmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdTZXJ2aWNlc0NvbnRyb2xsZXInXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgnbXljbGFzcycsIHtcbiAgICAgIHVybDogJy9teWNsYXNzJyxcbiAgICAgIHZpZXdzOiB7XG4gICAgICAgICdtYWluLXZpZXcnOiB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6IHZpZXdfcGF0aCArICdteWNsYXNzLmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdNeUNsYXNzQ29udHJvbGxlcidcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gICAgLnN0YXRlKCdteWNsYXNzRGV0YWlsJywge1xuICAgICAgdXJsOiAnL215Y2xhc3MtZGV0YWlsLzpjb2RlJyxcbiAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgZGF0YXNldDogZnVuY3Rpb24oJHEsICRzdGF0ZVBhcmFtcywgJGxvY2F0aW9uKSB7XG4gICAgICAgICAgdmFyIF9nb3QgPSBmYWxzZTtcbiAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgIHZhciBjbGFzc0RhdGEgPSAodHlwZW9mIGxvY2FsU3RvcmFnZS5teUNsYXNzICE9PSBcInVuZGVmaW5lZFwiID8gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UubXlDbGFzcykgOiBmYWxzZSk7XG4gICAgICAgICAgZm9yICh2YXIgZCBpbiBjbGFzc0RhdGEpIHtcbiAgICAgICAgICAgIGlmIChjbGFzc0RhdGFbZF0uY29kZSA9PSAkc3RhdGVQYXJhbXMuY29kZSkge1xuICAgICAgICAgICAgICBfZ290ID0gZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKF9nb3QpIHtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoX2dvdCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbXljbGFzcycpLnJlcGxhY2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB2aWV3czoge1xuICAgICAgICAnbWFpbi12aWV3Jzoge1xuICAgICAgICAgIHRlbXBsYXRlVXJsOiB2aWV3X3BhdGggKyAnbXljbGFzc0luc2lkZS5odG1sJyxcbiAgICAgICAgICBjb250cm9sbGVyOiAnTXlDbGFzc0RldGFpbENvbnRyb2xsZXInXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgnZXhhbVNjaGVkdWxlJywge1xuICAgICAgdXJsOiAnL2V4YW0tc2NoZWR1bGUnLFxuICAgICAgdmlld3M6IHtcbiAgICAgICAgJ21haW4tdmlldyc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogdmlld19wYXRoICsgJ3NlcnZpY2VzL2V4YW0tc2NoZWR1bGUuaHRtbCcsXG4gICAgICAgICAgY29udHJvbGxlcjogJ0V4YW1TY2hlZHVsZUNvbnRyb2xsZXInXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgnZXhhbVNjb3JlJywge1xuICAgICAgdXJsOiAnL2V4YW0tc2NvcmUnLFxuICAgICAgdmlld3M6IHtcbiAgICAgICAgJ21haW4tdmlldyc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogdmlld19wYXRoICsgJ3NlcnZpY2VzL2V4YW0tc2NvcmUuaHRtbCcsXG4gICAgICAgICAgY29udHJvbGxlcjogJ0V4YW1TY29yZUNvbnRyb2xsZXInXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgnZmluYW5jZVN0YXR1cycsIHtcbiAgICAgIHVybDogJy9maW5hbmNlLXN0YXR1cycsXG4gICAgICB2aWV3czoge1xuICAgICAgICAnbWFpbi12aWV3Jzoge1xuICAgICAgICAgIHRlbXBsYXRlVXJsOiB2aWV3X3BhdGggKyAnc2VydmljZXMvYmlsbGluZy5odG1sJyxcbiAgICAgICAgICBjb250cm9sbGVyOiAnRmluYW5jZUNvbnRyb2xsZXInXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIC5zdGF0ZSgnYWJzZW5jZScsIHtcbiAgICAgIHVybDogJy9hYnNlbmNlJyxcbiAgICAgIHZpZXdzOiB7XG4gICAgICAgICdtYWluLXZpZXcnOiB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6IHZpZXdfcGF0aCArICdzZXJ2aWNlcy9hYnNlbmNlLmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdBYnNlbmNlQ29udHJvbGxlcidcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gICAgLnN0YXRlKCdjb21pbmcnLCB7XG4gICAgICB1cmw6ICcvY29taW5nJyxcbiAgICAgIHZpZXdzOiB7XG4gICAgICAgICdtYWluLXZpZXcnOiB7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6IHZpZXdfcGF0aCArICdjb21pbmcuaHRtbCdcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoXCIvY29taW5nXCIpO1xufV0pO1xuIiwiYXBwLmNvbnRyb2xsZXIoJ0xvZ2luQ29udHJvbGxlcicsXG5mdW5jdGlvbigkc2NvcGUsICRpb25pY1BvcHVwLCAkdGltZW91dCwgJGlvbmljSGlzdG9yeSwgJGlvbmljTmF2QmFyRGVsZWdhdGUsICRyb290U2NvcGUsIEJpbnVzTWF5YSkge1xuXG4gICAgJHJvb3RTY29wZS5ub0hlYWRlciA9IHRydWU7XG4gICAgJGlvbmljTmF2QmFyRGVsZWdhdGUuc2hvd0JhcihmYWxzZSk7XG5cbiAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICRzY29wZS5sb2dpbkNsYXNzID0gJyc7XG5cbiAgICAkaW9uaWNIaXN0b3J5Lm5leHRWaWV3T3B0aW9ucyh7XG4gICAgICBkaXNhYmxlQmFjazogdHJ1ZVxuICAgIH0pO1xuXG4gICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCEoJHNjb3BlLmJpbnVzaWQgJiYgJHNjb3BlLnBhc3N3b3JkKSkge1xuICAgICAgICAkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgdGl0bGU6ICdPb3BzICEnLFxuICAgICAgICAgIHRlbXBsYXRlOiAnUGxlYXNlIElucHV0IEJpbnVzaWFuIElEIGFuZCBQYXNzd29yZCdcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkc2NvcGUubG9naW5DbGFzcyA9ICdvbi1sb2FkaW5nJztcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBCaW51c01heWEuYXBpKCcvJywgJ2dldCcpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICBpZihkLmNvZGUgIT09IDIwMCkgaGFuZGxlRXJyb3IoZCk7XG4gICAgICAgICAgdmFyIGRhdGEgPSB7fTtcbiAgICAgICAgICAkKCQoZC5yZXN1bHQpLnNlcmlhbGl6ZUFycmF5KCkpLmVhY2goZnVuY3Rpb24oaSwgZCkge1xuICAgICAgICAgICAgZGF0YVtkLm5hbWVdID0gZC52YWx1ZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBkYXRhLnR4dFVzZXJJZCA9ICRzY29wZS5iaW51c2lkO1xuICAgICAgICAgIGRhdGEudHh0UGFzc3dvcmQgPSAkc2NvcGUucGFzc3dvcmQ7XG4gICAgICAgICAgZGF0YS5idG5Mb2dpbiA9IFwiTG9nIEluIFwiO1xuICAgICAgICAgIHJldHVybiBCaW51c01heWEuYXBpKCcvJywgJ3Bvc3QnLCBkYXRhKTtcbiAgICAgICAgfSwgaGFuZGxlRXJyb3IpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICB2YXIgbmFtZSA9ICQoZC5yZXN1bHQpLmZpbmQoXCIjY29udGVudCAjdG9wYmFyIC5yaWdodCBzdHJvbmdcIik7XG4gICAgICAgICAgLy8gV2hlbiBTdWNjZXNzXG4gICAgICAgICAgaWYoZC5jb2RlICE9PSAyMDApXG4gICAgICAgICAgICBoYW5kbGVFcnJvcihkKTtcbiAgICAgICAgICBpZihuYW1lLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICBoYW5kbGVFcnJvcihkLCAkKGQucmVzdWx0KS5maW5kKFwiI2xibEVycm9yXCIpLnRleHQoKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAkc2NvcGUubG9naW5DbGFzcyA9ICcnO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEkgVGhpbmsgdGhhdCBub3QgYmVzdCBtZXRob2RcbiAgICAgICAgICAgICAqIEB0b2RvIG1ha2UgaXQgaGFzaFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UubG9naW5JZCA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgYmludXNpZDogJHNjb3BlLmJpbnVzaWQsXG4gICAgICAgICAgICAgIHBhc3N3b3JkOiAkc2NvcGUucGFzc3dvcmRcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UuaXNsb2dpbiA9IHRydWU7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UuZm5hbWUgPSBuYW1lLnRleHQoKTtcbiAgICAgICAgICAgICRyb290U2NvcGUubG9naW4gPSB0cnVlO1xuICAgICAgICAgICAgJHJvb3RTY29wZS5sb2dpbk5hbWUgPSBsb2NhbFN0b3JhZ2UuZm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICRzY29wZS5sb2dpbkNsYXNzID0gJyc7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAnIy9zY2hlZHVsZSc7XG4gICAgICAgICAgICAkaW9uaWNIaXN0b3J5LmNsZWFySGlzdG9yeSgpO1xuICAgICAgICAgICAgJGlvbmljTmF2QmFyRGVsZWdhdGUuc2hvd0JhY2tCdXR0b24oZmFsc2UpO1xuICAgICAgICAgIH1cblxuICAgICAgICB9LCBoYW5kbGVFcnJvcik7XG5cbiAgICAgICAgdmFyIGhhbmRsZUVycm9yID0gZnVuY3Rpb24oZGF0YSwgdGV4dCkge1xuICAgICAgICAgIHR5cGVvZiB0ZXh0ICE9PSBcInVuZGVmaW5lZFwiID8gdGV4dCA6IG51bGw7XG4gICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAkc2NvcGUubG9naW5DbGFzcyA9ICcnO1xuICAgICAgICAgICRpb25pY1BvcHVwLmFsZXJ0KHtcbiAgICAgICAgICAgIHRpdGxlOiAnT29wcyAhJyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiB0ZXh0ID8gdGV4dCA6ICdTb21ldGhpbmcgd3JvbmcgISdcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG4pO1xuIiwiLyoqXG4gKiBNeSBDbGFzcyBDb250cm9sbGVyXG4gKiBAYXV0aG9yIE5hdWZhbCA8bmF1ZmFsQG1hcnRhYmFrYW5nLnVzPlxuICovXG5hcHAuY29udHJvbGxlcignTXlDbGFzc0NvbnRyb2xsZXInLFxuICBmdW5jdGlvbigkc2NvcGUsIEJpbnVzTWF5YSwgJGlvbmljTmF2QmFyRGVsZWdhdGUsICRzdGF0ZSwgJGxvY2F0aW9uLCAkc3RhdGVQYXJhbXMsICR0aW1lb3V0LCAkcm9vdFNjb3BlLCAkaW9uaWNQbGF0Zm9ybSwgJHEsICRpb25pY1BvcHVwKSB7XG4gICAgJHJvb3RTY29wZS5ub0hlYWRlciA9IGZhbHNlO1xuICAgICRyb290U2NvcGUubGVmdE1lbnUgPSB0cnVlO1xuICAgICRpb25pY1BsYXRmb3JtLm9uSGFyZHdhcmVCYWNrQnV0dG9uKGZ1bmN0aW9uKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcblxuICAgICRzY29wZS5jbGFzc0RhdGEgPSAodHlwZW9mIGxvY2FsU3RvcmFnZS5teUNsYXNzICE9PSBcInVuZGVmaW5lZFwiID8gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UubXlDbGFzcykgOiBmYWxzZSk7XG5cbiAgICB2YXIgcmVmcmVzaE15Q2xhc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgQmludXNNYXlhLmNoZWNrTG9naW4oKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIEJpbnVzTWF5YS5hcGkoJy8nLCAnZ2V0Jyk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyBGYWlsIHRvIHJlLWxvZ2luXG4gICAgICAgICAgICByZWplY3QoXCJjYW4ndCByZS1hdXRoIHlvdXIgYWNjb3VudFwiKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC8vIExvYWQgVGhlc2UgUGFnZVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBCaW51c01heWEuZnJhbWUoXG4gICAgICAgICAgICAgICQoZC5yZXN1bHQpLmZpbmQoXCIuaXRlbUNvbnRlbnQgdWwgbGk6ZXEoMCkgPiBhXCIpLmF0dHIoXCJocmVmXCIpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmVqZWN0KFwiY2FuJ3QgYWNjZXNzIHRvIG1haW4gZnJhbWVcIik7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihjKSB7XG4gICAgICAgICAgICB2YXIgX3JlRGF0YSA9IFtdLFxuICAgICAgICAgICAgICBfcHJvbWlzZXNZb3UgPSBbXSxcbiAgICAgICAgICAgICAgX3Byb21pc2VzQ291bnQgPSAwO1xuICAgICAgICAgICAgJChjLnJlc3VsdC5yZXN1bHQpLmZpbmQoXCIjY3RsMDBfQ29udGVudFBsYWNlSG9sZGVyMV9wbmxUZW9yaSB1bCBsaVwiKS5lYWNoKGZ1bmN0aW9uKGksIGQpIHtcbiAgICAgICAgICAgICAgdmFyIG5hbWUgPSAkKGQpLmZpbmQoXCJhXCIpLmh0bWwoKSxcbiAgICAgICAgICAgICAgICAgIHJlZyA9IG5hbWUubWF0Y2goL14oLiopLSguKikgXFwoKC4qKVxcKS9pKTtcbiAgICAgICAgICAgICAgX3JlRGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICBpbmRleEl0ZW06IGksXG4gICAgICAgICAgICAgICAgbmFtZTogcmVnWzJdLFxuICAgICAgICAgICAgICAgIHVybDogJChkKS5maW5kKFwiYVwiKS5hdHRyKCdocmVmJyksXG4gICAgICAgICAgICAgICAgY29kZTogcmVnWzFdLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogcmVnWzNdXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UubXlDbGFzcyA9IEpTT04uc3RyaW5naWZ5KF9yZURhdGEpO1xuICAgICAgICAgICAgcmVzb2x2ZShfcmVEYXRhKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJlamVjdChcImNhbid0IGFjY2VzcyB0byBteSBjbGFzc1wiKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZG9SZWZyZXNoID0gZnVuY3Rpb24oKSB7XG4gICAgICByZWZyZXNoTXlDbGFzcygpXG4gICAgICAudGhlbihmdW5jdGlvbihkb25lKSB7XG4gICAgICAgIGlmIChkb25lLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAkc2NvcGUuY2xhc3NEYXRhID0gZG9uZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlcnJIYW5kbGUoXCJZb3UgZG9uJ3QgaGF2ZSBhbnkgY2xhc3NcIik7XG4gICAgICAgIH1cbiAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcbiAgICAgIH0sIGVyckhhbmRsZSk7XG5cbiAgICAgIHZhciBlcnJIYW5kbGUgPSBmdW5jdGlvbihtc2cpIHtcbiAgICAgICAgJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgIHRpdGxlOiAnT29wcyAhJyxcbiAgICAgICAgICB0ZW1wbGF0ZTogbXNnXG4gICAgICAgIH0pO1xuICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnc2Nyb2xsLnJlZnJlc2hDb21wbGV0ZScpO1xuICAgICAgfTtcbiAgICB9O1xuXG4gIH0pO1xuIiwiLyoqXG4gKiBNeSBDbGFzcyBJbnNpZGVcbiAqIEBhdXRob3IgTmF1ZmFsIDxuYXVmYWxAbWFydGFiYWthbmcudXM+XG4gKi9cbmFwcC5jb250cm9sbGVyKCdNeUNsYXNzRGV0YWlsQ29udHJvbGxlcicsXG4gIGZ1bmN0aW9uKCRzY29wZSwgQmludXNNYXlhLCAkaW9uaWNOYXZCYXJEZWxlZ2F0ZSwgJHN0YXRlLCAkbG9jYXRpb24sXG4gICAgJHN0YXRlUGFyYW1zLCAkdGltZW91dCwgJHJvb3RTY29wZSwgJGlvbmljUGxhdGZvcm0sICRxLCAkaW9uaWNQb3B1cCwgZGF0YXNldCkge1xuXG4gICAgJHNjb3BlLmNsYXNzRGF0YSA9ICh0eXBlb2YgbG9jYWxTdG9yYWdlLm15Q2xhc3MgIT09IFwidW5kZWZpbmVkXCIgPyBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5teUNsYXNzKSA6IGZhbHNlKTtcbiAgICAkc2NvcGUuc3RhdGUgPSB7XG4gICAgICBpc0RhdGE6IGZhbHNlLFxuICAgICAgbG9hZGluZzogdHJ1ZVxuICAgIH07XG4gICAgJHNjb3BlLmRhdGEgPSAkc2NvcGUuY2xhc3NEYXRhW2RhdGFzZXRdO1xuICAgICRzY29wZS5pbmZvVGFiID0gJ2FjdGl2ZSc7XG4gICAgJHNjb3BlLnRvcGljc1RhYiA9ICcnO1xuXG4gICAgdmFyIGdldENsYXNzRGV0YWlsID0gZnVuY3Rpb24odXJsKSB7XG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIEJpbnVzTWF5YS5jaGVja0xvZ2luKClcbiAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBCaW51c01heWEuYXBpKCcvJywgJ2dldCcpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gRmFpbCB0byByZS1sb2dpblxuICAgICAgICAgICAgcmVqZWN0KFwiY2FuJ3QgcmUtYXV0aCB5b3VyIGFjY291bnRcIik7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAvLyBMb2FkIFRoZXNlIFBhZ2VcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICByZXR1cm4gQmludXNNYXlhLmZyYW1lKFxuICAgICAgICAgICAgICAkKGQucmVzdWx0KS5maW5kKFwiLml0ZW1Db250ZW50IHVsIGxpOmVxKDApID4gYVwiKS5hdHRyKFwiaHJlZlwiKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJlamVjdChcImNhbid0IGFjY2VzcyB0byBtYWluIGZyYW1lXCIpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oYykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coKVxuICAgICAgICAgICAgcmV0dXJuIEJpbnVzTWF5YS5hcGkoX2JpbWF5X2FwaV91cmwgKyAnL0xNUy8nICsgdXJsLCAnZ2V0Jywge30sIHRydWUpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmVqZWN0KFwiY2FuJ3QgYWNjZXNzIHRvIG15IGNsYXNzXCIpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgdmFyIGRvbmUgPSBkLnJlc3VsdDtcbiAgICAgICAgICAgIHZhciBkZXNjX21haW4gPSAkKGRvbmUpLmZpbmQoXCIjZGVzY19jb3Vyc2VfZGVzYyA+IHNwYW5cIikuaHRtbCgpLFxuICAgICAgICAgICAgICBkZXNjX2dyYWQgPSAkKGRvbmUpLmZpbmQoXCIjZGVzY19ncmFkX2NvbXBldGUgPiBzcGFuXCIpLmh0bWwoKSxcbiAgICAgICAgICAgICAgY291cnNlID0gW107XG5cbiAgICAgICAgICAgICQoZG9uZSkuZmluZChcIiNjdGwwMF9Db250ZW50UGxhY2VIb2xkZXIxX3BubENvbnRlbnRUaGVvcnkgdGFibGUgdGJvZHkgdHJcIikuZWFjaChmdW5jdGlvbihpLCBkKSB7XG4gICAgICAgICAgICAgIGlmIChpICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgY291cnNlLnB1c2goe1xuICAgICAgICAgICAgICAgICAgc2Vzc2lvbjogcGFyc2VJbnQoJChkKS5maW5kKFwidGQ6ZXEoMCkgPiBzcGFuXCIpLmh0bWwoKSksXG4gICAgICAgICAgICAgICAgICBtb2RlOiAkKGQpLmZpbmQoXCJ0ZDplcSgxKSA+IHNwYW5cIikuaHRtbCgpLFxuICAgICAgICAgICAgICAgICAgdG9waWNzOiAkKGQpLmZpbmQoXCJ0ZDplcSgyKSA+IGFcIikuaHRtbCgpLFxuICAgICAgICAgICAgICAgICAgZGF0ZTogJChkKS5maW5kKFwidGQ6ZXEoMykgPiBzcGFuXCIpLmh0bWwoKSxcbiAgICAgICAgICAgICAgICAgIGxpbmtzOiAkKGQpLmZpbmQoXCJ0ZDplcSg0KSA+IGlucHV0XCIpLmF0dHIoJ25hbWUnKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIF9yZURhdGEgPSB7XG4gICAgICAgICAgICAgIG1haW5fZGVzY3JpcHRpb246IGRlc2NfbWFpbixcbiAgICAgICAgICAgICAgZ3JhZF9kZXNjcmlwdGlvbjogZGVzY19ncmFkLFxuICAgICAgICAgICAgICBjb3Vyc2U6IGNvdXJzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlc29sdmUoX3JlRGF0YSk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZWplY3QoXCJjYW4ndCBhY2Nlc3MgdG8gY291cnNlIHBhZ2VcIik7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiAkc2NvcGUuY2xhc3NEYXRhW2RhdGFzZXRdLmRldGFpbCA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBnZXRDbGFzc0RldGFpbCgkc2NvcGUuY2xhc3NEYXRhW2RhdGFzZXRdLnVybClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICRzY29wZS5jbGFzc0RhdGFbZGF0YXNldF0uZGV0YWlsID0gZGF0YTtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2UubXlDbGFzcyA9IEpTT04uc3RyaW5naWZ5KCRzY29wZS5jbGFzc0RhdGEpO1xuICAgICAgICAgICRzY29wZS4kYXBwbHlBc3luYyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzY29wZS5zdGF0ZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAkc2NvcGUuc3RhdGUuaXNEYXRhID0gJHNjb3BlLmNsYXNzRGF0YVtkYXRhc2V0XS5kZXRhaWw7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcbiAgICAgICAgfSwgZXJySGFuZGxlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJHNjb3BlLnN0YXRlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICRzY29wZS5zdGF0ZS5pc0RhdGEgPSAkc2NvcGUuY2xhc3NEYXRhW2RhdGFzZXRdLmRldGFpbDtcbiAgICB9XG5cbiAgICBpZiAoJHNjb3BlLmlzUGFnZVRvcGljID09PSBmYWxzZSkge1xuICAgICAgJHNjb3BlLmluZm9UYWIgPSAnYWN0aXZlJztcbiAgICAgICRzY29wZS50b3BpY3NUYWIgPSAnJztcbiAgICB9IGVsc2Uge1xuICAgICAgJHNjb3BlLmluZm9UYWIgPSAnJztcbiAgICAgICRzY29wZS50b3BpY3NUYWIgPSAnYWN0aXZlJztcbiAgICB9XG5cbiAgICAkc2NvcGUuc3dpdGNoVGFiID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgICAgIGlmIChzdGF0ZSA9PT0gMCkge1xuICAgICAgICAkc2NvcGUuaXNQYWdlVG9waWMgPSBmYWxzZTtcbiAgICAgICAgJHNjb3BlLmluZm9UYWIgPSAnYWN0aXZlJztcbiAgICAgICAgJHNjb3BlLnRvcGljc1RhYiA9ICcnO1xuICAgICAgfVxuICAgICAgaWYgKHN0YXRlID09PSAxKSB7XG4gICAgICAgICRzY29wZS5pc1BhZ2VUb3BpYyA9IHRydWU7XG4gICAgICAgICRzY29wZS5pbmZvVGFiID0gJyc7XG4gICAgICAgICRzY29wZS50b3BpY3NUYWIgPSAnYWN0aXZlJztcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIGVyckhhbmRsZSA9IGZ1bmN0aW9uKG1zZykge1xuICAgICAgJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICB0aXRsZTogJ09vcHMgIScsXG4gICAgICAgIHRlbXBsYXRlOiBtc2dcbiAgICAgIH0pO1xuICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcbiAgICB9O1xuXG5cbiAgfSk7XG4iLCIvKipcbiAqIFNjaGVkdWxlIENvbnRyb2xsZXJcbiAqIEBhdXRob3IgTmF1ZmFsIDxuYXVmYWxAbWFydGFiYWthbmcudXM+XG4gKi9cbmFwcC5jb250cm9sbGVyKCdTY2hlZHVsZUNvbnRyb2xsZXInLFxuICBmdW5jdGlvbigkc2NvcGUsICRpb25pY1BvcHVwLCAkdGltZW91dCwgJGlvbmljSGlzdG9yeSwgJHJvb3RTY29wZSwgJGlvbmljUGxhdGZvcm0sIEJpbnVzTWF5YSwgJHEpIHtcblxuICAgICRyb290U2NvcGUubm9IZWFkZXIgPSBmYWxzZTtcbiAgICAkcm9vdFNjb3BlLmxlZnRNZW51ID0gdHJ1ZTtcbiAgICAkaW9uaWNQbGF0Zm9ybS5vbkhhcmR3YXJlQmFja0J1dHRvbihmdW5jdGlvbihlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuZ2V0U3RhdGUgPSBmdW5jdGlvbihkKSB7XG4gICAgICB2YXIgdG9kYXkgPSBtb21lbnQoKTtcbiAgICAgIC8vdG9kYXlcbiAgICAgIGlmIChtb21lbnQoZCkuaXNTYW1lKHRvZGF5LCAnZGF5JykpIHtcbiAgICAgICAgcmV0dXJuICd0b2RheSc7XG4gICAgICB9IGVsc2VcbiAgICAgIC8vdG9tb3Jyb3dcbiAgICAgIGlmIChtb21lbnQoZCkuaXNTYW1lKHRvZGF5LmFkZCgxLCAnZCcpLCAnZGF5JykpIHtcbiAgICAgICAgcmV0dXJuICd0b21vcnJvdyc7XG4gICAgICB9IGVsc2VcbiAgICAgIC8vbGFzdGVkXG4gICAgICBpZiAobW9tZW50KGQpIDwgdG9kYXkpIHtcbiAgICAgICAgcmV0dXJuICdjb21wbGV0byc7XG4gICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5nZXRDb3Vyc2VTdGF0ZSA9IGZ1bmN0aW9uKGQsIG0pIHtcbiAgICAgIHZhciBub3cgPSBtb21lbnQoKSxcbiAgICAgICAgZ2V0TW9tZW50ID0gbnVsbDtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBnZXRMYXN0ID0gbS5zcGxpdChcIi1cIilbMV0uc3BsaXQoXCI6XCIpLFxuICAgICAgICAgIGdldEhvdXIgPSBwYXJzZUludChnZXRMYXN0WzBdKSxcbiAgICAgICAgICBnZXRNaW51dGUgPSBwYXJzZUludChnZXRMYXN0WzFdKTtcblxuICAgICAgICBnZXRNb21lbnQgPSBtb21lbnQoZCkuaG91cihnZXRIb3VyKS5taW51dGUoZ2V0TWludXRlKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgZ2V0TW9tZW50ID0gbW9tZW50KGQpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZ2V0TW9tZW50IDwgbm93KSB7XG4gICAgICAgIHJldHVybiAnY29tcGxldG8nO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUuaXNTY2hlZHVsZSA9IGZhbHNlO1xuICAgICRzY29wZS5zY2hlZHVsZSA9IFtdO1xuXG4gICAgaWYgKGxvY2FsU3RvcmFnZS5qYWR3YWwpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmIChKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5qYWR3YWwpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAkc2NvcGUuaXNTY2hlZHVsZSA9IHRydWU7XG4gICAgICAgICAgJHNjb3BlLnNjaGVkdWxlID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuamFkd2FsKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZSkge1xuXG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIHRvSnNvbiA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgIHZhciBoYXNpbCA9IFtdO1xuICAgICAgJChkYXRhKS5maW5kKCd0cicpLmVhY2goZnVuY3Rpb24oaSwgYSkge1xuICAgICAgICB2YXIgaHQgPSAkKHRoaXMpLmZpbmQoJ3RkJyk7XG4gICAgICAgIGlmIChpID4gMCkge1xuICAgICAgICAgIGhhc2lsLnB1c2goe1xuICAgICAgICAgICAgZGF0ZTogaHQuZXEoMCkuaHRtbCgpLFxuICAgICAgICAgICAgdGltZTogaHQuZXEoMSkuaHRtbCgpLFxuICAgICAgICAgICAgc3RhdGU6IGh0LmVxKDIpLmh0bWwoKSxcbiAgICAgICAgICAgIGNvdXJzZTogaHQuZXEoMykuaHRtbCgpLnNwbGl0KFwiLVwiKVsxXSxcbiAgICAgICAgICAgIGNvZGU6IGh0LmVxKDMpLmh0bWwoKS5zcGxpdChcIi1cIilbMF0sXG4gICAgICAgICAgICBteUNsYXNzOiBodC5lcSg1KS5odG1sKCksXG4gICAgICAgICAgICByb29tOiBodC5lcSg2KS5odG1sKCksXG4gICAgICAgICAgICBidWlsZGluZzogaHQuZXEoNykuaHRtbCgpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGhhc2lsO1xuICAgIH07XG5cbiAgICB2YXIgcmVmcmVzaEphZHdhbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBCaW51c01heWEuY2hlY2tMb2dpbigpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gQmludXNNYXlhLmFwaSgnLycsICdnZXQnKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIEZhaWwgdG8gcmUtbG9naW5cbiAgICAgICAgICAgIHJlamVjdChcImNhbid0IHJlLWF1dGggeW91ciBhY2NvdW50XCIpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLy8gTG9hZCBUaGVzZSBQYWdlXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgcmV0dXJuIEJpbnVzTWF5YS5mcmFtZShcbiAgICAgICAgICAgICAgJChkLnJlc3VsdCkuZmluZChcIi5pdGVtQ29udGVudCB1bCBsaTplcSgwKSA+IGFcIikuYXR0cihcImhyZWZcIilcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZWplY3QoXCJjYW4ndCBhY2Nlc3MgdG8gbWFpbiBmcmFtZVwiKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGMpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0ge30sXG4gICAgICAgICAgICAgIGQgPSBjLnJlc3VsdDtcbiAgICAgICAgICAgICQoJChkLnJlc3VsdCkuc2VyaWFsaXplQXJyYXkoKSkuZWFjaChmdW5jdGlvbihpLCBkKSB7XG4gICAgICAgICAgICAgIGRhdGFbZC5uYW1lXSA9IGQudmFsdWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRhdGEuX19FVkVOVFRBUkdFVCA9ICdjdGwwMCRDb250ZW50UGxhY2VIb2xkZXIxJGJ0blNjaGVkdWxlJztcbiAgICAgICAgICAgIHJldHVybiBCaW51c01heWEuYXBpKF9iaW1heV9hcGlfdXJsICsgJy9MTVMvTXlDbGFzcy5hc3B4JywgJ3Bvc3QnLCBkYXRhLCB0cnVlKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJlamVjdChcImNhbid0IGFjY2VzcyBmcmFtZVwiKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGQpO1xuICAgICAgICAgICAgdmFyIF9zY2hlZHVsZSA9ICQoZC5yZXN1bHQpLmZpbmQoXCJ0YWJsZVwiKSxcbiAgICAgICAgICAgICAgdG9kYXkgPSB0b0pzb24oX3NjaGVkdWxlLmVxKDApLmh0bWwoKSksXG4gICAgICAgICAgICAgIG5leHQgPSB0b0pzb24oX3NjaGVkdWxlLmVxKDEpLmh0bWwoKSksXG4gICAgICAgICAgICAgIHNrZWR1bCA9IHRvZGF5LmNvbmNhdChuZXh0KTtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5qYWR3YWwgPSBKU09OLnN0cmluZ2lmeShCaW51c01heWEuZ3JvdXBpbmcoc2tlZHVsKSk7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UubGFzdFVwZGF0ZSA9IG1vbWVudCgpLmZvcm1hdCgnRCBNTU1NIFlZWVkgaDptbTpzcycpO1xuICAgICAgICAgICAgcmVzb2x2ZSh7amFkd2FsOiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5qYWR3YWwpLCBsYXN0VXBkYXRlOiBsb2NhbFN0b3JhZ2UubGFzdFVwZGF0ZX0pO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmVqZWN0KFwiY2FuJ3QgYWNjZXNzIHNjaGVkdWxlIHBhZ2VcIik7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmRvUmVmcmVzaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmVmcmVzaEphZHdhbCgpXG4gICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnc2Nyb2xsLnJlZnJlc2hDb21wbGV0ZScpO1xuICAgICAgICAkcm9vdFNjb3BlLmdldExhc3RVcGRhdGUoKTtcbiAgICAgICAgaWYgKGRhdGEuamFkd2FsLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAkc2NvcGUuaXNTY2hlZHVsZSA9IHRydWU7XG4gICAgICAgICAgJHNjb3BlLnNjaGVkdWxlID0gZGF0YS5qYWR3YWw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXJySGFuZGxlKFwiTm8gU2NoZWR1bGUgZm91bmRcIik7XG4gICAgICAgIH1cbiAgICAgIH0sIGVyckhhbmRsZSk7XG5cbiAgICAgIHZhciBlcnJIYW5kbGUgPSBmdW5jdGlvbihtc2cpIHtcbiAgICAgICAgJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgIHRpdGxlOiAnT29wcyAhJyxcbiAgICAgICAgICB0ZW1wbGF0ZTogbXNnXG4gICAgICAgIH0pO1xuICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnc2Nyb2xsLnJlZnJlc2hDb21wbGV0ZScpO1xuICAgICAgfTtcbiAgICB9O1xuXG4gIH0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9